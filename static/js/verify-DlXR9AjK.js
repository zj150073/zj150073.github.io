import{d as e,m as a,o as i,a as t,r as n,n as s,p as o,f as l,b as d,g as c,q as r,s as h,v as u,u as v,t as p,T as g,w as f,e as m,i as w,h as X}from"./index-DTxOO0Gw.js";const x=["width","height"],y=["width","height"],T=["width","height"],Y=[c("div",{class:"loading-gif_"},[c("span"),c("span"),c("span"),c("span"),c("span")],-1)],b={class:"auth-control_"},S={class:"range-text"},M=[c("div",null,null,-1),c("div",null,null,-1),c("div",null,null,-1)],B=e({__name:"App",props:{type:{type:String,default:"modal"},canvasWidth:{type:Number,default:310},canvasHeight:{type:Number,default:160},show:{type:Boolean,default:!1},puzzleScale:{type:Number,default:1},sliderSize:{type:Number,default:50},range:{type:Number,default:10},zIndex:{type:Number,default:999},imgs:{type:Array,default:null},successText:{type:String,default:"验证通过！"},failText:{type:String,default:"验证失败，请重试"},sliderText:{type:String,default:"拖动滑块完成拼图"},className:{type:String,default:""}},emits:["success","fail","close","reset"],setup(e,{expose:f,emit:m}){const w=e;a((()=>{document.addEventListener("mousemove",R,!1),document.addEventListener("mouseup",F,!1),document.addEventListener("touchmove",R,{passive:!1}),document.addEventListener("touchend",F,!1),A.isInside="inside"===w.type,w.show&&(!A.isInside&&document.body.classList.add("vue-puzzle-overflow"),N())})),i((()=>{A.timer1&&clearTimeout(A.timer1),document.removeEventListener("mousemove",R,!1),document.removeEventListener("mouseup",F,!1),document.removeEventListener("touchmove",R,!1),document.removeEventListener("touchend",F,!1)}));const X=t(),B=t(),C=t(),I=t(),A=n({isInside:!1,mouseDown:!1,startWidth:50,startX:0,newX:0,pinX:0,pinY:0,loading:!1,isCanSlide:!1,error:!1,infoBoxShow:!1,infoText:"",infoBoxFail:!1,timer1:void 0,closeDown:!1,isSuccess:!1,imgIndex:-1,isSubmting:!1});s((()=>w.show),(e=>{e?(!A.isInside&&document.body.classList.add("vue-puzzle-overflow"),N()):(A.isSubmting=!1,A.isSuccess=!1,A.infoBoxShow=!1,document.body.classList.remove("vue-puzzle-overflow"))})),s((()=>w.type),(e=>{"inside"===e?(A.isInside=!0,document.body.classList.remove("vue-puzzle-overflow")):A.isInside=!1}));const z=o((()=>{const e=A.startWidth+A.newX-A.startX;return e<H.value?H.value:e>w.canvasWidth?w.canvasWidth:e})),W=o((()=>Math.round(52.5*Math.max(Math.min(w.puzzleScale,2),.2)+6))),H=o((()=>Math.max(Math.min(Math.round(w.sliderSize),Math.round(.5*w.canvasWidth)),10))),D=o((()=>999!==w.zIndex?`z-index:${w.zIndex}`:"")),L=()=>{A.isInside||(A.closeDown=!0)},k=()=>{A.closeDown&&(!A.mouseDown&&!A.isSubmting&&(A.timer1&&clearTimeout(A.timer1),m("close"))),A.closeDown=!1},P=e=>{var a;A.isCanSlide&&(A.mouseDown=!0,A.startWidth=(null==(a=X.value)?void 0:a.clientWidth)||0,A.newX=void 0!==e.clientX?e.clientX:e.changedTouches[0].clientX,A.startX=void 0!==e.clientX?e.clientX:e.changedTouches[0].clientX)},R=e=>{A.mouseDown&&(e.preventDefault(),A.newX=void 0!==e.clientX?e.clientX:e.changedTouches[0].clientX)},F=()=>{A.mouseDown&&(A.mouseDown=!1,J())},O=(e=!1)=>{var a;if(A.loading&&!e)return;A.loading=!0,A.isCanSlide=!1;const i=B.value,t=C.value,n=I.value,s=null==i?void 0:i.getContext("2d",{willReadFrequently:!0}),o=null==t?void 0:t.getContext("2d"),l=null==n?void 0:n.getContext("2d");if(!s||!o||!l)return;const d=navigator.userAgent.indexOf("Firefox")>=0&&navigator.userAgent.indexOf("Windows")>=0,c=document.createElement("img");if(s.fillStyle="rgba(255,255,255,1)",l.fillStyle="rgba(255,255,255,1)",s.clearRect(0,0,w.canvasWidth,w.canvasHeight),o.clearRect(0,0,w.canvasWidth,w.canvasHeight),A.pinX=E(W.value+20,w.canvasWidth-W.value-10),A.pinY=E(20,w.canvasHeight-W.value-10),c.crossOrigin="anonymous",c.onload=()=>{const[e,a,i,t]=Z(c),n=Math.random(),r=Math.random(),h=Math.random(),u=n<.33?-1:n<.66?0:1,v=r<.33?-1:r<.66?0:1,p=h<.33?-1:h<.66?0:1;let g=Math.random()<.6?1:0;u===v&&v===p&&p===g&&0===g&&(g=1),s.save(),Q(s,u,v,p,g),s.closePath(),d?(s.clip(),s.save(),s.shadowOffsetX=0,s.shadowOffsetY=0,s.shadowColor="#000",s.shadowBlur=3,s.fill(),s.restore()):(s.shadowOffsetX=0,s.shadowOffsetY=0,s.shadowColor="#000",s.shadowBlur=3,s.fill(),s.clip()),s.drawImage(c,e,a,i,t),l.fillRect(0,0,w.canvasWidth,w.canvasHeight),l.drawImage(c,e,a,i,t),s.globalCompositeOperation="source-atop",Q(s,u,v,p,g),s.arc(A.pinX+Math.ceil(W.value/2),A.pinY+Math.ceil(W.value/2),1.2*W.value,0,2*Math.PI,!0),s.closePath(),s.shadowColor="rgba(255, 255, 255, .8)",s.shadowOffsetX=-1,s.shadowOffsetY=-1,s.shadowBlur=Math.min(Math.ceil(8*w.puzzleScale),12),s.fillStyle="#ffffaa",s.fill();const f=s.getImageData(A.pinX-3,A.pinY-20,A.pinX+W.value+5,A.pinY+W.value+5);o.putImageData(f,0,A.pinY-20),s.restore(),s.clearRect(0,0,w.canvasWidth,w.canvasHeight),s.save(),Q(s,u,v,p,g),s.globalAlpha=.8,s.fillStyle="#ffffff",s.fill(),s.restore(),s.save(),s.globalCompositeOperation="source-atop",Q(s,u,v,p,g),s.arc(A.pinX+Math.ceil(W.value/2),A.pinY+Math.ceil(W.value/2),1.2*W.value,0,2*Math.PI,!0),s.shadowColor="#000",s.shadowOffsetX=2,s.shadowOffsetY=2,s.shadowBlur=16,s.fill(),s.restore(),s.save(),s.globalCompositeOperation="destination-over",s.drawImage(c,e,a,i,t),s.restore(),A.loading=!1,A.isCanSlide=!0},c.onerror=()=>{O(!0)},!e&&null!=(a=w.imgs)&&a.length){let e=E(0,w.imgs.length-1);e===A.imgIndex&&(e===w.imgs.length-1?e=0:e++),A.imgIndex=e,c.src=w.imgs[e]}else c.src=_()},E=(e,a)=>Math.ceil(Math.random()*(a-e)+e),Z=e=>{const a=e.width/e.height;let i=0,t=0,n=0,s=0;return a>w.canvasWidth/w.canvasHeight?(s=w.canvasHeight,n=a*s,t=0,i=(w.canvasWidth-n)/2):(n=w.canvasWidth,s=n/a,i=0,t=(w.canvasHeight-s)/2),[i,t,n,s]},Q=(e,a,i,t,n)=>{const s=Math.ceil(15*w.puzzleScale);e.beginPath(),e.moveTo(A.pinX,A.pinY),e.lineTo(A.pinX+s,A.pinY),e.arcTo(A.pinX+s,A.pinY+a*s/2,A.pinX+s+s/2,A.pinY+a*s/2,s/2),e.arcTo(A.pinX+s+s,A.pinY+a*s/2,A.pinX+s+s,A.pinY,s/2),e.lineTo(A.pinX+s+s+s,A.pinY),e.lineTo(A.pinX+s+s+s,A.pinY+s),e.arcTo(A.pinX+s+s+s+i*s/2,A.pinY+s,A.pinX+s+s+s+i*s/2,A.pinY+s+s/2,s/2),e.arcTo(A.pinX+s+s+s+i*s/2,A.pinY+s+s,A.pinX+s+s+s,A.pinY+s+s,s/2),e.lineTo(A.pinX+s+s+s,A.pinY+s+s+s),e.lineTo(A.pinX+s+s,A.pinY+s+s+s),e.arcTo(A.pinX+s+s,A.pinY+s+s+s+t*s/2,A.pinX+s+s/2,A.pinY+s+s+s+t*s/2,s/2),e.arcTo(A.pinX+s,A.pinY+s+s+s+t*s/2,A.pinX+s,A.pinY+s+s+s,s/2),e.lineTo(A.pinX,A.pinY+s+s+s),e.lineTo(A.pinX,A.pinY+s+s),e.arcTo(A.pinX+n*s/2,A.pinY+s+s,A.pinX+n*s/2,A.pinY+s+s/2,s/2),e.arcTo(A.pinX+n*s/2,A.pinY+s,A.pinX,A.pinY+s,s/2),e.lineTo(A.pinX,A.pinY)},_=()=>{const e=document.createElement("canvas"),a=e.getContext("2d");if(!a)return"";e.width=w.canvasWidth,e.height=w.canvasHeight,a.fillStyle=`rgb(${E(100,255)},${E(100,255)},${E(100,255)})`,a.fillRect(0,0,w.canvasWidth,w.canvasHeight);for(let i=0;i<12;i++)if(a.fillStyle=`rgb(${E(100,255)},${E(100,255)},${E(100,255)})`,a.strokeStyle=`rgb(${E(100,255)},${E(100,255)},${E(100,255)})`,E(0,2)>1)a.save(),a.rotate(E(-90,90)*Math.PI/180),a.fillRect(E(-20,e.width-20),E(-20,e.height-20),E(10,e.width/2+10),E(10,e.height/2+10)),a.restore();else{a.beginPath();const i=E(-Math.PI,Math.PI);a.arc(E(0,e.width),E(0,e.height),E(10,e.height/2+10),i,i+1.5*Math.PI),a.closePath(),a.fill()}return e.toDataURL("image/png")},J=()=>{A.isSubmting=!0;const e=z.value-H.value-(W.value-H.value)*((z.value-H.value)/(w.canvasWidth-H.value)),a=A.pinX-3-e;Math.abs(a)<w.range?(A.infoText=w.successText,A.infoBoxFail=!1,A.infoBoxShow=!0,A.isCanSlide=!1,A.isSuccess=!0,A.timer1&&clearTimeout(A.timer1),A.timer1=setTimeout((()=>{A.isSubmting=!1,m("success",a,{deviation:a,offsetX:e,pinX:A.pinX-3})}),800)):(A.infoText=w.failText,A.infoBoxFail=!0,A.infoBoxShow=!0,A.isCanSlide=!1,m("fail",a,{deviation:a,offsetX:e,pinX:A.pinX-3}),A.timer1&&clearTimeout(A.timer1),A.timer1=setTimeout((()=>{A.isSubmting=!1,N()}),800))},N=e=>{A.isSubmting||(A.infoBoxFail=!1,A.infoBoxShow=!1,A.isCanSlide=!1,A.isSuccess=!1,A.startWidth=H.value,A.startX=0,A.newX=0,O(),e&&m("reset"))};return f({reset:N}),(a,i)=>(l(),d(g,{to:"body",disabled:A.isInside},[c("div",{class:u(["vue-puzzle-vcode",{inside_:A.isInside,show_:e.show},e.className]),style:h(v(D)),onMousedown:L,onMouseup:k,onTouchstartPassive:L,onTouchend:k},[c("div",{class:"vue-auth-box_",onMousedown:i[3]||(i[3]=r((()=>{}),["stop"])),onTouchstart:i[4]||(i[4]=r((()=>{}),["stop"]))},[c("div",{class:"auth-body_",style:h(`width:${e.canvasWidth}px;height: ${e.canvasHeight}px`)},[c("canvas",{ref_key:"canvas1",ref:B,class:"auth-canvas1_",width:e.canvasWidth,height:e.canvasHeight},null,8,x),c("canvas",{ref_key:"canvas3",ref:I,class:u(["auth-canvas3_",{show:A.isSuccess}]),width:e.canvasWidth,height:e.canvasHeight},null,10,y),c("canvas",{ref_key:"canvas2",ref:C,class:"auth-canvas2_",width:v(W),height:e.canvasHeight,style:h(`width:${v(W)}px;height:${e.canvasHeight}px;transform:translateX(${v(z)-v(H)-(v(W)-v(H))*((v(z)-v(H))/(e.canvasWidth-v(H)))}px)`)},null,12,T),c("div",{class:u(["loading-box_",{hide_:!A.loading}])},Y,2),c("div",{class:u(["info-box_",{show:A.infoBoxShow},{fail:A.infoBoxFail}])},p(A.infoText),3),c("div",{class:u(["flash_",{show:A.isSuccess}]),style:h(`transform: translateX(${A.isSuccess?`${e.canvasWidth+.578*e.canvasHeight}px`:`-${.578*e.canvasHeight}px`}) skew(-30deg, 0);`)},null,6),c("img",{class:"reset_",onClick:i[0]||(i[0]=e=>N(!0)),src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAELklEQVRYR+2YW2wUZRTH//9vtlCoF9IoIklT3PqgPGi326hoetuaGEhIr9SgCYkkgt2WGOQVCca+GavWdr0GjD4YhG3RB3hply1LQA1tEQIxEXapGI2pEkys9LIzx2ylYWfY6e5sF0oi+7hzzvl+3/9855xvhrjNf7zN+XAHcL4Z+n8o6JWTeYt++W25S596AIZy6TB+n3yo+Nchlk8vmIIVowdXU9c3Q1gDSilBlQwjgBAYFGDvdF58/4milqvZwDpOcXWsb5Uh8hmBqkwXFMhlCN8aX5LXNbRy/T+Z+iXsHAFWRXs3QGQPyLucLDJrK5DgUXdTsxPfjAEro8E3Ce50EtxsKxPTwCPH3U2jTmJkBJgWTnAMxDeGMEoa0xQ+LJQnCD4HYFkCyAC3RdwN3U7gMkpxRTTYrMD91sCJIgCxV5R6O1Jcfy7VwonqLoj9/CqB2kF341qncGkBvRe+ureAWpRgoalCBecMFzcdK24YymZRJz5zprgq1tsJwXYL3CVZGvdGHmwZc7JQtra2gE+f712ep2QUYP714DJhaJrXLqXZQszlZwtYdSHoB9ljVk/ePVrSZFL0ZkAlxzQBVseCT8WhZhRThtFB8plk9Zi/qCi8cv0fNxvKFrDy4oF11NXXIFy2EII4iBcG3Y03VLZT8OqRd5aFPduvOEpxRayvXolxAKB2g6NgEhobBlc1HHYKY7WvHf5wtVAPgegIlbbZ9seUZ7AyFnwewi9pGoUyDmhrB931kfnC1ZwOeKlLP8GZJi6QLSFP2yep4toXSbT3ZQAfX3O6omt8Nhd9r/aHQAUMOQywYBZo5uZD2ThQ2rbPCjlnH6yI9rUryE5DU75ctJaake46Be4DuDjF8dFBNA94/AdtiySVxIlpMlTS8td801o70vMigM9huTda2lhcKHVHPO2HZv/P6LIwX7hk/+qzPSvUJGMkrg8AQYTkroRdXMlE+HH/twsG6BsOdJHYZlaO/lBZ6weOiiSXqs3Gqj0TeAxx+T75DIpgwjC0onD51pQD4JaluPrkR/cpFT9DcoVp84LOgTL/DjtBbglgou+puHwB8lEznPxJw1XSX77VtgizBvQNBw4RMqB7xt4Lc3c8lQKJaQHoO4R8ydz0/7MWoCXk8c85MrMC9J3qaafw/WtQlwXST+F3BnAeYB4obgJ1BJIuG+YtiKAjVOZ/Pd1ZdwzoG+4uBtSPpjaRbhXLcwF3hzytb2TilgVgT5BkYybBrTYC+Rvg5nRpdTRJrIs8+VPXPQXj2i4ItxC4O2NQQUQnN4U9rRcz9nH64p4ceM2lziX5Y4s3KHCdUHwE77ecMkMEp6BwhIa2Z6DslZRvfulgHafYLuCas58WLp2aLCFUga70qxOFU6dPFL2W1feYeaU43Y5z/TxnCuYabMEuC043ckdBp4pZ7f8FE5psOI1g6fwAAAAASUVORK5CYII="})],4),c("div",b,[c("div",{class:"range-box",style:h(`height:${v(H)}px;width:${e.canvasWidth}px`)},[c("div",S,p(e.sliderText),1),c("div",{class:"range-slider",ref_key:"rangeSlider",ref:X,style:h(`width:${v(z)}px`)},[c("div",{class:u(["range-btn",{isDown:A.mouseDown}]),style:h(`width:${v(H)}px`),onMousedown:i[1]||(i[1]=e=>P(e)),onTouchstart:i[2]||(i[2]=e=>P(e))},M,38)],4)],4)])],32)],38)],8,["disabled"]))}}),C={class:"font-medium"},I={class:"bg-[rgba(15,23,42,0.2)] p-6 w-[360px]"},A=e({__name:"verify",setup(e){const a=t(!0);function i(){}function n(){}return(e,t)=>{const s=m("el-link"),o=m("el-card");return l(),d(o,{shadow:"never"},{header:f((()=>[c("div",C,[w(s,{href:"https://github.com/javaLuo/vue-puzzle-vcode/tree/vue3",target:"_blank",style:{margin:"0 5px 4px 0","font-size":"16px"}},{default:f((()=>[X(" 拼图人机验证、右滑拼图验证 ")])),_:1})]),w(s,{class:"mt-2",href:"https://github.com/pure-admin/vue-pure-admin/blob/main/src/views/able/verify.vue",target:"_blank"},{default:f((()=>[X(" 代码位置 src/views/able/verify.vue ")])),_:1})])),default:f((()=>[c("div",I,[w(v(B),{show:a.value,type:"inside",onFail:n,onSuccess:i},null,8,["show"])])])),_:1})}}});export{A as default};
