var e=(e,t,l)=>new Promise(((r,o)=>{var s=e=>{try{n(l.next(e))}catch(t){o(t)}},a=e=>{try{n(l.throw(e))}catch(t){o(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,a);n((l=l.apply(e,t)).next())}));import{d as t}from"./dayjs-BWHVJBZs.js";import{_ as l}from"./role.vue_vue_type_script_setup_true_lang-TsgajYUi.js";import{_ as r}from"./index.vue_vue_type_script_setup_true_lang-Il3Hl5vL.js";import{z as o}from"./@zxcvbn-ts-CekykbdX.js";import{K as s,m as a,a as n}from"./index-B2iGRBN9.js";import{u as i}from"./user-DNtD0Fqa.js";import{u}from"./hooks-1lxAD9ho.js";import{R as p}from"./index-DqYaBQpN.js";import{j as d,n as c,$ as m,g as v}from"./@pureadmin-f9nW_l6N.js";import{e as f,k as j,l as h,m as g}from"./system-B7ZtQss2.js";import{aY as w,Q as x,K as y,o as b,az as k}from"./element-plus-DsFyl0Kk.js";import{S,r as R,b as z,w as C,J as _,s as P,a1 as T,a6 as $,x as I,F as D}from"./@vue-CFXrvzpc.js";import"./@amap-Bx2D3lnM.js";import"./index-CAaOogHN.js";import"./fastest-levenshtein-CdIjA0Lf.js";import"./vite-plugin-fake-server-CytHVkXj.js";import"./@faker-js-CRy60TLX.js";import"./version-rocket-chvOQqaV.js";import"./@iconify-icons-CxRB8ffa.js";import"./@vueuse-tP1Y4vdd.js";import"./defu-iUM7Auia.js";import"./framesync-CUhBu5sQ.js";import"./style-value-types-UCYNu-x1.js";import"./popmotion-DRTv1-mp.js";import"./hey-listen-DkH12NBk.js";import"./plus-pro-components-CYEVFP0q.js";import"./sortablejs-DhhifNSC.js";import"./@element-plus-Bqpau_gV.js";import"./lodash-es-BgzC0s9P.js";import"./axios-B1L2Kzed.js";import"./vue-i18n-DB-7wkrF.js";import"./@intlify-DfwD9yJy.js";import"./js-cookie-BXEMiIsG.js";import"./pinia-DzAV29mk.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-CGx-uoKe.js";import"./axs-request-CnYniYE7.js";import"./nprogress-L6f6pfEY.js";import"./echarts-D2b6xzX-.js";import"./zrender-CUz1GrA9.js";import"./tslib-ZseNXxlj.js";import"./vxe-table-CPtn8uUL.js";import"./xe-utils-CdBoVBzI.js";import"./dom-zindex-Ckn4mXSH.js";import"./responsive-storage-5vfjqqcs.js";import"./vue-DWYrQbHy.js";import"./@iconify-BUzAfhQo.js";/* empty css                 */import"./vue-tippy-DPYCMIfw.js";import"./@popperjs-D3lHDW-0.js";import"./@ctrl-D2oWfImC.js";import"./async-validator-Cuo4gI4y.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-kghe82LF.js";import"./index-CGVlznxj.js";import"./cropperjs-jYnVaWAX.js";function O(O,M){const W=S({deptId:"",username:"",phone:"",status:""}),Y=R(),B=R(),L=R([]),U=R(!0),q=R(),F=R({}),{switchStyle:H}=u(),V=R(),A=R([]),K=R(!0),J=R(0),N=S({total:0,pageSize:10,currentPage:1,background:!0}),E=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"用户编号",prop:"id",width:90},{label:"用户头像",prop:"avatar",cellRenderer:({row:e})=>P(T("el-image"),{fit:"cover","preview-teleported":!0,src:e.avatar||i,"preview-src-list":Array.of(e.avatar||i),class:"w-[24px] h-[24px] rounded-full align-middle"},null),width:90},{label:"用户名称",prop:"username",minWidth:130},{label:"用户昵称",prop:"nickname",minWidth:130},{label:"性别",prop:"sex",minWidth:90,cellRenderer:({row:e,props:t})=>P(T("el-tag"),{size:t.size,type:1===e.sex?"danger":null,effect:"plain"},{default:()=>[1===e.sex?"女":"男"]})},{label:"部门",prop:"dept.name",minWidth:90},{label:"手机号码",prop:"phone",minWidth:90,formatter:({phone:e})=>m(e,{start:3,end:6})},{label:"状态",prop:"status",minWidth:90,cellRenderer:e=>{var t;return P(T("el-switch"),{size:"small"===e.props.size?"small":"default",loading:null==(t=F.value[e.index])?void 0:t.loading,modelValue:e.row.status,"onUpdate:modelValue":t=>e.row.status=t,"active-value":1,"inactive-value":0,"active-text":"已启用","inactive-text":"已停用","inline-prompt":!0,style:H.value,onChange:()=>function({row:e,index:t}){w.confirm(`确认要<strong>${0===e.status?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.username}</strong>用户吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then((()=>{F.value[t]=Object.assign({},F.value[t],{loading:!0}),setTimeout((()=>{F.value[t]=Object.assign({},F.value[t],{loading:!1}),a("已成功修改用户状态",{type:"success"})}),300)})).catch((()=>{0===e.status?e.status=1:e.status=0}))}(e)},null)}},{label:"创建时间",minWidth:90,prop:"createTime",formatter:({createTime:e})=>t(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:180,slot:"operation"}],Q=z((()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"])),G=S({newPwd:""}),X=[{color:"#e74242",text:"非常弱"},{color:"#EFBD47",text:"弱"},{color:"#ffa500",text:"一般"},{color:"#1bbf1b",text:"强"},{color:"#008000",text:"非常强"}],Z=R(),ee=R([]);function te(){return e(this,null,(function*(){U.value=!0;const{data:e}=yield h($(W));L.value=e.list,N.total=e.total,N.pageSize=e.pageSize,N.currentPage=e.currentPage,setTimeout((()=>{U.value=!1}),500)}))}function le(e){if(!e||!e.length)return;const t=[];for(let l=0;l<e.length;l++)e[l].disabled=0===e[l].status,le(e[l].children),t.push(e[l]);return t}const re=R();return C(G,(({newPwd:e})=>Z.value=d(e)?-1:o(e).score)),_((()=>e(this,null,(function*(){K.value=!0,te();const{data:e}=yield f();V.value=s(e),A.value=s(e),K.value=!1,ee.value=(yield j()).data})))),{form:W,loading:U,columns:E,dataList:L,treeData:A,treeLoading:K,selectedNum:J,pagination:N,buttonClass:Q,deviceDetection:c,onSearch:te,resetForm:e=>{e&&(e.resetFields(),W.deptId="",M.value.onTreeReset(),te())},onbatchDel:function(){const e=O.value.getTableRef().getSelectionRows();a(`已删除用户编号为 ${v(e,"id")} 的数据`,{type:"success"}),O.value.getTableRef().clearSelection(),te()},openDialog:function(e="新增",t){var l,o,s,i,u,p,d,m,v;n({title:`${e}用户`,props:{formInline:{title:e,higherDeptOptions:le(V.value),parentId:null!=(l=null==t?void 0:t.dept.id)?l:0,nickname:null!=(o=null==t?void 0:t.nickname)?o:"",username:null!=(s=null==t?void 0:t.username)?s:"",password:null!=(i=null==t?void 0:t.password)?i:"",phone:null!=(u=null==t?void 0:t.phone)?u:"",email:null!=(p=null==t?void 0:t.email)?p:"",sex:null!=(d=null==t?void 0:t.sex)?d:"",status:null!=(m=null==t?void 0:t.status)?m:1,remark:null!=(v=null==t?void 0:t.remark)?v:""}},width:"46%",draggable:!0,fullscreen:c(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>I(r,{ref:Y}),beforeSure:(t,{options:l})=>{const r=Y.value.getRef(),o=l.props.formInline;function s(){a(`您${e}了用户名称为${o.username}的这条数据`,{type:"success"}),t(),te()}r.validate((e=>{e&&s()}))}})},onTreeSelect:function({id:e,selected:t}){W.deptId=t?e:"",te()},handleUpdate:function(e){},handleDelete:function(e){a(`您删除了用户编号为${e.id}的这条数据`,{type:"success"}),te()},handleUpload:function(e){n({title:"裁剪、上传头像",width:"40%",closeOnClickModal:!1,fullscreen:c(),contentRenderer:()=>I(p,{ref:re,imgSrc:e.avatar||i,onCropper:e=>q.value=e}),beforeSure:e=>{e(),te()},closeCallBack:()=>re.value.hidePopover()})},handleReset:function(e){n({title:`重置 ${e.username} 用户的密码`,width:"30%",draggable:!0,closeOnClickModal:!1,fullscreen:c(),contentRenderer:()=>P(D,null,[P(x,{ref:B,model:G},{default:()=>[P(y,{prop:"newPwd",rules:[{required:!0,message:"请输入新密码",trigger:"blur"}]},{default:()=>[P(b,{clearable:!0,"show-password":!0,type:"password",modelValue:G.newPwd,"onUpdate:modelValue":e=>G.newPwd=e,placeholder:"请输入新密码"},null)]})]}),P("div",{class:"mt-4 flex"},[X.map((({color:e,text:t},l)=>P("div",{class:"w-[19vw]",style:{marginLeft:0!==l?"4px":0}},[P(k,{striped:!0,"striped-flow":!0,duration:Z.value===l?6:0,percentage:Z.value>=l?100:0,color:e,"stroke-width":10,"show-text":!1},null),P("p",{class:"text-center",style:{color:Z.value===l?e:""}},[t])])))])]),closeCallBack:()=>G.newPwd="",beforeSure:t=>{B.value.validate((l=>{l&&(a(`已成功重置 ${e.username} 用户的密码`,{type:"success"}),t(),te())}))}})},handleRole:function(t){return e(this,null,(function*(){var e,r,o,s;const a=null!=(e=(yield g({userId:t.id})).data)?e:[];n({title:`分配 ${t.username} 用户的角色`,props:{formInline:{username:null!=(r=null==t?void 0:t.username)?r:"",nickname:null!=(o=null==t?void 0:t.nickname)?o:"",roleOptions:null!=(s=ee.value)?s:[],ids:a}},width:"400px",draggable:!0,fullscreen:c(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>I(l),beforeSure:(e,{options:t})=>{t.props.formInline,e()}})}))},handleSizeChange:function(e){},onSelectionCancel:function(){J.value=0,O.value.getTableRef().clearSelection()},handleCurrentChange:function(e){},handleSelectionChange:function(e){J.value=e.length,O.value.setAdaptive()}}}export{O as useUser};
