import{d as t,A as e,w as r,r as n,bC as o,b as i,K as a,L as s,D as l,o as u,c,F as d,g as f,a as p,C as g,q as h,H as m,J as y,e as v}from"./@vue-CFXrvzpc.js";const w="undefined"!=typeof window;function b(t,e=200,r={}){return function(t,e){return function(...r){t((()=>e.apply(this,r)),{fn:e,thisArg:this,args:r})}}(function(t,e={}){let r,n;return o=>{const i=l(t),a=l(e.maxWait);if(r&&clearTimeout(r),i<=0||void 0!==a&&a<=0)return n&&(clearTimeout(n),n=null),o();a&&!n&&(n=setTimeout((()=>{r&&clearTimeout(r),n=null,o()}),a)),r=setTimeout((()=>{n&&clearTimeout(n),n=null,o()}),i)}}(e,r),t)}const A=w?window:void 0,O="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},_="__vueuse_ssr_handlers__";O[_]=O[_]||{};var I,z,E=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,S=(t,e)=>{var r={};for(var n in t)R.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&E)for(var n of E(t))e.indexOf(n)<0&&x.call(t,n)&&(r[n]=t[n]);return r};function D(t,e,n={}){const o=n,{window:i=A}=o,u=S(o,["window"]);let c;const d=i&&"ResizeObserver"in i,f=()=>{c&&(c.disconnect(),c=void 0)},p=r((()=>function(t){var e;const r=l(t);return null!=(e=null==r?void 0:r.$el)?e:r}(t)),(t=>{f(),d&&i&&t&&(c=new ResizeObserver(e),c.observe(t,u))}),{immediate:!0,flush:"post"}),g=()=>{f(),p()};var h;return h=g,a()&&s(h),{isSupported:d,stop:g}}w&&(null==window?void 0:window.navigator)&&(null==(I=null==window?void 0:window.navigator)?void 0:I.platform)&&/iP(ad|hone|od)/.test(null==(z=null==window?void 0:window.navigator)?void 0:z.platform);function P(t){const e=n(0),r=n(null);D(r,(t=>{const r=t[0],{width:n}=r.contentRect;e.value=n}));const o=i((()=>(({breakpoints:t,wrapperWidth:e,gutter:r,hasAroundGutter:n,initWidth:o})=>{const i=Object.keys(t).map((t=>Number(t))).sort(((t,e)=>t-e));let a=e,s=!1;for(const u of i)if(e<=u){a=u,s=!0;break}if(!s)return o;const l=t[a].rowPerView;return n?(e-r)/l-r:(e-(l-1)*r)/l})({wrapperWidth:e.value,breakpoints:t.breakpoints,gutter:t.gutter,hasAroundGutter:t.hasAroundGutter,initWidth:t.width}))),a=i((()=>{const r=t.hasAroundGutter?-t.gutter:t.gutter;return Math.floor((e.value+r)/(o.value+t.gutter))})),s=i((()=>{if("left"===t.align)return 0;if("center"===t.align){const r=t.hasAroundGutter?t.gutter:-t.gutter,n=a.value*(o.value+t.gutter)+r;return(e.value-n)/2}{const r=t.hasAroundGutter?t.gutter:-t.gutter,n=a.value*(o.value+t.gutter)+r;return e.value-n}}));return{waterfallWrapper:r,wrapperWidth:e,colWidth:o,cols:a,offsetX:s}}function L(t,e){return new RegExp(`(^|\\s)${e}(\\s|$)`).test(t.className)}function N(t,e){if(L(t,e))return;const r=t.className.split(/\s+/);r.push(e),t.className=r.join(" ")}const j=document.createElement("div").style,T=(()=>{const t={standard:"transform",webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform"};for(const e in t){if(void 0!==j[t[e]])return e}return!1})();function W(t){return!1!==T&&("standard"===T?t:T+t.charAt(0).toUpperCase()+t.substr(1))}const k=W("transform"),C=W("animation-duration"),G=W("animation-delay"),$=W("transition"),B=W("animation-fill-mode");function H(t,e,r,o,i){const a=n([]),s=n(0),l=r=>{const n=t.hasAroundGutter?r+1:r;return t.gutter*n+e.value*r+o.value},u=function(t){return(e,r)=>{const n=e.firstChild;if(n&&!L(n,t.animationPrefix)){const e=t.animationDuration/1e3+"s",o=t.animationDelay/1e3+"s",i=n.style;N(n,t.animationPrefix),N(n,t.animationEffect),C&&(i[C]=e),G&&(i[G]=o),B&&(i[B]="both"),r&&setTimeout((()=>{r()}),t.animationDuration+t.animationDelay)}}}(t);return{wrapperHeight:s,layoutHandle:()=>{return n=this,o=null,c=function*(){return new Promise((n=>{a.value=new Array(r.value).fill(t.hasAroundGutter?t.gutter:0);const o=[];if(i&&i.value&&i.value.childNodes.forEach((t=>{"waterfall-item"===t.className&&o.push(t)})),0===o.length)return!1;for(let r=0;r<o.length;r++){const n=o[r],i=Math.min.apply(null,a.value),s=a.value.indexOf(i),c=l(s),d=n.style;k&&(d[k]=`translate3d(${c}px,${i}px, 0)`),d.width=`${e.value}px`,d.visibility="visible";const{height:f}=n.getBoundingClientRect();a.value[s]+=f+t.gutter,u(n,(()=>{const e=t.posDuration/1e3;$&&(d[$]=`transform ${e}s`)}))}s.value=Math.max.apply(null,a.value),setTimeout((()=>{n(!0)}),t.posDuration)}))},new Promise(((t,e)=>{var r=t=>{try{a(c.next(t))}catch(r){e(r)}},i=t=>{try{a(c.throw(t))}catch(r){e(r)}},a=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,i);a((c=c.apply(n,o)).next())}));var n,o,c}}}const M="undefined"!=typeof window&&null!==window,K=function(){if(M&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)return"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0;return!1}(),V=Object.prototype.propertyIsEnumerable,F=Object.getOwnPropertySymbols;function U(t){return"function"==typeof t||"[object Object]"===toString.call(t)}function X(t){return"__proto__"!==t&&"constructor"!==t&&"prototype"!==t}function q(t,...e){if(!U(t))throw new TypeError("expected the first argument to be an object");if(0===e.length||"function"!=typeof Symbol||"function"!=typeof F)return t;for(const r of e){const e=F(r);for(const n of e)V.call(r,n)&&(t[n]=r[n])}return t}function J(t,...e){let r=0;var n;for(("object"==typeof(n=t)?null===n:"function"!=typeof n)&&(t=e[r++]),t||(t={});r<e.length;r++)if(U(e[r])){for(const n of Object.keys(e[r]))X(n)&&(U(t[n])&&U(e[r][n])?J(t[n],e[r][n]):t[n]=e[r][n]);q(t,e[r])}return t}function Q(t,e){return new Promise(((r,n)=>{const o=new Image;o.onload=()=>{r(o)},o.onerror=()=>{n(new Error("Image load error"))},e&&(o.crossOrigin="Anonymous"),o.src=t}))}var Y,Z;(Z=Y||(Y={})).LOADING="loading",Z.LOADED="loaded",Z.ERROR="error";const tt={rootMargin:"0px",threshold:0},et="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";class rt{constructor(t=!0,e,r=!0){this.lazyActive=!0,this.crossOrigin=!0,this.options={loading:et,error:"",observerOptions:tt,log:!0,ratioCalculator:(t,e)=>e/t},this._images=new WeakMap,this.lazyActive=t,this.crossOrigin=r,this.config(e)}config(t={}){J(this.options,t),t.ratioCalculator&&(this.options.ratioCalculator=t.ratioCalculator)}mount(t,e,r){const{src:n,loading:o,error:i}=this._valueFormatter(e);t.setAttribute("lazy",Y.LOADING),t.setAttribute("src",o||et),this.lazyActive?(K||(this._setImageSrc(t,n,r,i),this._log((()=>{throw new Error("Not support IntersectionObserver!")}))),this._initIntersectionObserver(t,n,r,i)):this._setImageSrc(t,n,r,i)}resize(t,e){const r=t.getAttribute("lazy"),n=t.getAttribute("src");r&&r===Y.LOADED&&n&&Q(n,this.crossOrigin).then((r=>{const{width:n,height:o}=r,i=t.width/n*o;t.height=i;t.style.height=`${i}px`,e()}))}unmount(t){const e=this._realObserver(t);e&&e.unobserve(t),this._images.delete(t)}_setImageSrc(t,e,r,n){if(!e)return;t.getAttribute("src")!==e&&Q(e,this.crossOrigin).then((n=>{var o,i;const{width:a,height:s}=n,l=(null==(i=(o=this.options).ratioCalculator)?void 0:i.call(o,a,s))||s/a;t.parentNode.parentNode.style.paddingBottom=100*l+"%",t.setAttribute("lazy",Y.LOADED),t.removeAttribute("src"),t.setAttribute("src",e),r(!0)})).catch((()=>{const o=this._realObserver(t);o&&o.disconnect(),n&&(t.setAttribute("lazy",Y.ERROR),t.setAttribute("src",n),r(!1)),this._log((()=>{throw new Error(`Image failed to load!And failed src was: ${e} `)}))}))}_isOpenLazy(){return K&&this.lazyActive}_initIntersectionObserver(t,e,r,n){const o=this.options.observerOptions;this._images.set(t,new IntersectionObserver((o=>{Array.prototype.forEach.call(o,(o=>{if(o.isIntersecting){const i=this._realObserver(t);i&&i.unobserve(o.target),this._setImageSrc(t,e,r,n)}}))}),o));const i=this._realObserver(t);i&&i.observe(t)}_valueFormatter(t){let e=t,r=this.options.loading,n=this.options.error;return U(t)&&(e=t.src,r=t.loading||this.options.loading,n=t.error||this.options.error),{src:e,loading:r,error:n}}_log(t){this.options.log&&t()}_realObserver(t){return this._images.get(t)}}var nt=(t,e)=>{for(const[r,n]of e)t[r]=n;return t};const ot=t({props:{list:{type:Array,default:()=>[]},rowKey:{type:String,default:"id"},imgSelector:{type:String,default:"src"},width:{type:Number,default:200},breakpoints:{type:Object,default:()=>({1200:{rowPerView:3},800:{rowPerView:2},500:{rowPerView:1}})},gutter:{type:Number,default:10},hasAroundGutter:{type:Boolean,default:!0},posDuration:{type:Number,default:300},animationPrefix:{type:String,default:"animate__animated"},animationEffect:{type:String,default:"fadeIn"},animationDuration:{type:Number,default:1e3},animationDelay:{type:Number,default:300},backgroundColor:{type:String,default:"#fff"},lazyload:{type:Boolean,default:!0},loadProps:{type:Object,default:()=>{}},crossOrigin:{type:Boolean,default:!0},delay:{type:Number,default:300},align:{type:String,default:"center"}},setup(t,o){const i=new rt(t.lazyload,t.loadProps,t.crossOrigin);e("lazy",i);const{waterfallWrapper:a,wrapperWidth:s,colWidth:l,cols:u,offsetX:c}=P(t),{wrapperHeight:d,layoutHandle:f}=H(t,l,u,c,a),p=b((()=>{f().then((()=>{o.emit("afterRender")}))}),t.delay);r((()=>[s,l,t.list]),(()=>{s.value>0&&p()}),{deep:!0});const g=n(0);e("sizeChangeTime",g),e("imgLoaded",p);return{waterfallWrapper:a,wrapperHeight:d,getRenderURL:e=>function(t,...e){return e.map((e=>e.replace(/\[(\w+)\]/g,".$1").split(".").reduce(((t,e)=>t&&t[e]),t)))}(e,t.imgSelector)[0],getKey:(e,r)=>e[t.rowKey]||r,renderer:p}}}),it=()=>{o((t=>({"84adae44":t.backgroundColor})))},at=ot.setup;ot.setup=at?(t,e)=>(it(),at(t,e)):it;const st={class:"waterfall-card"};var lt=nt(ot,[["render",function(t,e,r,n,o,i){return u(),c("div",{ref:"waterfallWrapper",class:"waterfall-list",style:h({height:`${t.wrapperHeight}px`})},[(u(!0),c(d,null,f(t.list,((e,r)=>(u(),c("div",{key:t.getKey(e,r),class:"waterfall-item"},[p("div",st,[g(t.$slots,"item",{item:e,index:r,url:t.getRenderURL(e)},void 0,!0)])])))),128))],4)}],["__scopeId","data-v-6d3e5303"]]);const ut=t({props:{url:{type:String,default:""},title:{type:String,default:""},alt:{type:String,default:""}},setup(t,e){const r=m("imgLoaded"),o=m("lazy"),i=n(null);return y((()=>{!function(){if(!i.value)return;o.mount(i.value,t.url,(n=>{r(),n?e.emit("success",t.url):e.emit("error",t.url)}))}()})),v((()=>{!function(){if(!i.value)return;o.unmount(i.value)}()})),{lazyRef:i,imageLoad:function(){e.emit("load",t.url)}}}}),ct={class:"lazy__box"},dt={class:"lazy__resource"},ft=["title","alt"];var pt=nt(ut,[["render",function(t,e,r,n,o,i){return u(),c("div",ct,[p("div",dt,[p("img",{ref:"lazyRef",class:"lazy__img",title:t.title,alt:t.alt,onLoad:e[0]||(e[0]=(...e)=>t.imageLoad&&t.imageLoad(...e))},null,40,ft)])])}],["__scopeId","data-v-640f8d40"]]);export{pt as L,lt as W};
