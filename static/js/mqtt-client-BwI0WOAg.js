var e=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;import{m as o}from"./mqtt-D7PT7uaY.js";import{d as t,S as u,r as d,e as n,f as s,B as r,a1 as p,o as c,a as i,E as m,s as v,D as b,p as f,l as _,c as y,g as h,F as V}from"./@vue-CFXrvzpc.js";import"./@amap-Bx2D3lnM.js";import"./dagre-ByuBQOTl.js";import"./graphlib-DbWR6NsI.js";import"./lodash-Cqbeouo3.js";const g=i("h1",null,"设置",-1),q=i("h1",null,"订阅",-1),w=i("h1",null,"发布",-1),k=i("span",null,"主题",-1),j=i("h1",null,"接收",-1),x=t({__name:"mqtt-client",setup(t){const x="https:"===location.protocol?"wss":"ws",U=[0,1,2],T=u({protocol:x,host:"broker.emqx.io",port:"wss"===x?8084:8083,clientId:"emqx_vue3_"+Math.random().toString(16).substring(2,8),username:"emqx_test",password:"emqx_test",clean:!0,connectTimeout:3e4,reconnectPeriod:4e3}),M=d({topic:"topic/mqttx",qos:0}),C=d({topic:"topic/browser",qos:0,payload:'{ "msg": "Hello, I am browser." }'});let I=d({connected:!1});const O=d(""),Q=d(!1),S=d(""),D=d(0),E=()=>{I.value={connected:!1},D.value=0,S.value="",Q.value=!1},P=()=>{if(D.value+=1,D.value>5)try{I.value.end(),E()}catch(e){}},$=()=>{try{S.value="connect";const t=T,{protocol:u,host:d,port:n}=t,s=((o,t)=>{var u={};for(var d in o)l.call(o,d)&&t.indexOf(d)<0&&(u[d]=o[d]);if(null!=o&&e)for(var d of e(o))t.indexOf(d)<0&&a.call(o,d)&&(u[d]=o[d]);return u})(t,["protocol","host","port"]),r=`${u}://${d}:${n}/mqtt`;I.value=o.connect(r,s),I.value.on&&(I.value.on("connect",(()=>{S.value=""})),I.value.on("reconnect",P),I.value.on("error",(e=>{})),I.value.on("message",((e,l)=>{O.value=O.value.concat(l.toString())})))}catch(t){S.value=""}},B=()=>{S.value="subscribe";const{topic:e,qos:l}=M.value;I.value.subscribe(e,{qos:l},((e,l)=>{S.value="",e||(Q.value=!0)}))},X=()=>{S.value="unsubscribe";const{topic:e,qos:l}=M.value;I.value.unsubscribe(e,{qos:l},(e=>{S.value="",Q.value=!1}))},z=()=>{S.value="publish";const{topic:e,qos:l,payload:a}=C.value;I.value.publish(e,a,{qos:l},(e=>{S.value=""}))},F=()=>{if(I.value.connected){S.value="disconnect";try{I.value.end(!1,(()=>{E()}))}catch(e){S.value=""}}},H=e=>{T.port="wss"===e?8084:8083};return n((()=>{try{I.value.end&&I.value.end()}catch(e){}})),(e,l)=>{const a=p("el-link"),o=p("el-option"),t=p("el-select"),u=p("el-form-item"),d=p("el-col"),n=p("el-input"),x=p("el-button"),D=p("el-row"),E=p("el-form"),P=p("el-card"),A=p("el-text");return c(),s(P,{shadow:"never","body-style":{padding:"20px"}},{header:r((()=>[i("div",null,[m(" 基于 "),v(a,{type:"primary",underline:!1,href:"https://github.com/mqttjs/MQTT.js",target:"_blank"},{default:r((()=>[m(" MQTT.js ")])),_:1}),m(" 和 免费的公共MQTT代理 "),v(a,{type:"primary",underline:!1,href:"broker.emqx.io",target:"_blank"},{default:r((()=>[m(" EMQX ")])),_:1}),m(" 实现的一套 MQTT 客户端 ")]),v(a,{class:"mt-2",href:"https://github.com/pure-admin/vue-pure-admin/blob/main/src/views/able/mqtt-client.vue",target:"_blank"},{default:r((()=>[m(" 代码位置 src/views/able/mqtt-client.vue ")])),_:1})])),default:r((()=>[v(P,{shadow:"never"},{default:r((()=>[g,v(E,{"label-position":"top",model:T},{default:r((()=>[v(D,{gutter:20},{default:r((()=>[v(d,{span:8},{default:r((()=>[v(u,{prop:"protocol",label:"协议"},{default:r((()=>[v(t,{modelValue:T.protocol,"onUpdate:modelValue":l[0]||(l[0]=e=>T.protocol=e),onChange:H},{default:r((()=>[v(o,{label:"ws://",value:"ws"}),v(o,{label:"wss://",value:"wss"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),v(d,{span:8},{default:r((()=>[v(u,{prop:"host",label:"主机"},{default:r((()=>[v(n,{modelValue:T.host,"onUpdate:modelValue":l[1]||(l[1]=e=>T.host=e)},null,8,["modelValue"])])),_:1})])),_:1}),v(d,{span:8},{default:r((()=>[v(u,{prop:"port",label:"端口"},{default:r((()=>[v(n,{modelValue:T.port,"onUpdate:modelValue":l[2]||(l[2]=e=>T.port=e),modelModifiers:{number:!0},type:"number",placeholder:"8083/8084"},null,8,["modelValue"])])),_:1})])),_:1}),v(d,{span:8},{default:r((()=>[v(u,{prop:"clientId",label:"客户端ID"},{default:r((()=>[v(n,{modelValue:T.clientId,"onUpdate:modelValue":l[3]||(l[3]=e=>T.clientId=e)},null,8,["modelValue"])])),_:1})])),_:1}),v(d,{span:8},{default:r((()=>[v(u,{prop:"username",label:"用户名"},{default:r((()=>[v(n,{modelValue:T.username,"onUpdate:modelValue":l[4]||(l[4]=e=>T.username=e)},null,8,["modelValue"])])),_:1})])),_:1}),v(d,{span:8},{default:r((()=>[v(u,{prop:"password",label:"密码"},{default:r((()=>[v(n,{modelValue:T.password,"onUpdate:modelValue":l[5]||(l[5]=e=>T.password=e)},null,8,["modelValue"])])),_:1})])),_:1}),v(d,{span:24},{default:r((()=>[v(x,{type:"primary",disabled:b(I).connected,loading:"connect"===S.value,onClick:$},{default:r((()=>[m(f(b(I).connected?"已连接":"连接"),1)])),_:1},8,["disabled","loading"]),b(I).connected?(c(),s(x,{key:0,type:"danger",loading:"disconnect"===S.value,onClick:F},{default:r((()=>[m(" 断开连接 ")])),_:1},8,["loading"])):_("",!0)])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),v(P,{shadow:"never",class:"mt-4"},{default:r((()=>[q,v(E,{"label-position":"top",model:M.value},{default:r((()=>[v(D,{gutter:20,align:"middle"},{default:r((()=>[v(d,{span:8},{default:r((()=>[v(u,{prop:"topic",label:"主题"},{default:r((()=>[v(n,{modelValue:M.value.topic,"onUpdate:modelValue":l[6]||(l[6]=e=>M.value.topic=e),disabled:Q.value},null,8,["modelValue","disabled"])])),_:1})])),_:1}),v(d,{span:8},{default:r((()=>[v(u,{prop:"qos",label:"通信质量"},{default:r((()=>[v(t,{modelValue:M.value.qos,"onUpdate:modelValue":l[7]||(l[7]=e=>M.value.qos=e),disabled:Q.value},{default:r((()=>[(c(),y(V,null,h(U,(e=>v(o,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})])),_:1}),v(D,null,{default:r((()=>[v(d,null,{default:r((()=>[v(x,{type:"primary",class:"sub-btn",loading:"subscribe"===S.value,disabled:!b(I).connected||Q.value,onClick:B},{default:r((()=>[m(f(Q.value?"已订阅":"订阅"),1)])),_:1},8,["loading","disabled"]),Q.value?(c(),s(x,{key:0,type:"primary",class:"sub-btn",loading:"unsubscribe"===S.value,disabled:!b(I).connected,onClick:X},{default:r((()=>[m(" 取消订阅 ")])),_:1},8,["loading","disabled"])):_("",!0)])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),v(P,{shadow:"never",class:"mt-4"},{default:r((()=>[w,v(E,{"label-position":"top",model:C.value},{default:r((()=>[v(D,{gutter:20},{default:r((()=>[v(d,{span:8},{default:r((()=>[v(u,{prop:"topic"},{label:r((()=>[k,v(A,{type:"info",size:"small"},{default:r((()=>[m(" 可将订阅主题设置为topic/browser，测试MQTT的自发自收。 ")])),_:1})])),default:r((()=>[v(n,{modelValue:C.value.topic,"onUpdate:modelValue":l[8]||(l[8]=e=>C.value.topic=e)},null,8,["modelValue"])])),_:1})])),_:1}),v(d,{span:8},{default:r((()=>[v(u,{prop:"payload",label:"有效载荷"},{default:r((()=>[v(n,{modelValue:C.value.payload,"onUpdate:modelValue":l[9]||(l[9]=e=>C.value.payload=e)},null,8,["modelValue"])])),_:1})])),_:1}),v(d,{span:8},{default:r((()=>[v(u,{prop:"qos",label:"通信质量"},{default:r((()=>[v(t,{modelValue:C.value.qos,"onUpdate:modelValue":l[10]||(l[10]=e=>C.value.qos=e)},{default:r((()=>[(c(),y(V,null,h(U,(e=>v(o,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),v(d,{span:24},{default:r((()=>[v(x,{type:"primary",loading:"publish"===S.value,disabled:!b(I).connected,onClick:z},{default:r((()=>[m(" 发布 ")])),_:1},8,["loading","disabled"])])),_:1})])),_:1}),v(P,{shadow:"never",class:"mt-4"},{default:r((()=>[j,v(d,{span:24},{default:r((()=>[v(n,{modelValue:O.value,"onUpdate:modelValue":l[11]||(l[11]=e=>O.value=e),type:"textarea",rows:3,readonly:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})}}});export{x as default};
