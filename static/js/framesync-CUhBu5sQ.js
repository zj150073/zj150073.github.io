const e=1/60*1e3,t="undefined"!=typeof performance?()=>performance.now():()=>Date.now(),n="undefined"!=typeof window?e=>window.requestAnimationFrame(e):n=>setTimeout((()=>n(t())),e);let s=!0,c=!1,r=!1;const o={delta:0,timestamp:0},d=["read","update","preRender","render","postRender"],a=d.reduce(((e,t)=>(e[t]=function(e){let t=[],n=[],s=0,c=!1,r=!1;const o=new WeakSet,d={schedule:(e,r=!1,d=!1)=>{const a=d&&c,i=a?t:n;return r&&o.add(e),-1===i.indexOf(e)&&(i.push(e),a&&c&&(s=t.length)),e},cancel:e=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1),o.delete(e)},process:a=>{if(c)r=!0;else{if(c=!0,[t,n]=[n,t],n.length=0,s=t.length,s)for(let n=0;n<s;n++){const s=t[n];s(a),o.has(s)&&(d.schedule(s),e())}c=!1,r&&(r=!1,d.process(a))}}};return d}((()=>c=!0)),e)),{}),i=d.reduce(((e,t)=>{const n=a[t];return e[t]=(e,t=!1,s=!1)=>(c||f(),n.schedule(e,t,s)),e}),{}),p=d.reduce(((e,t)=>(e[t]=a[t].cancel,e)),{});d.reduce(((e,t)=>(e[t]=()=>a[t].process(o),e)),{});const u=e=>a[e].process(o),l=t=>{c=!1,o.delta=s?e:Math.max(Math.min(t-o.timestamp,40),1),o.timestamp=t,r=!0,d.forEach(u),r=!1,c&&(s=!1,n(l))},f=()=>{c=!0,s=!0,r||n(l)},m=()=>o;export{p as c,m as g,i as s};
