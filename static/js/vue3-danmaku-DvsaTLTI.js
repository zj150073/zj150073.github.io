import{c as e,a as t,j as n,C as a,d as l,r as s,b as u,S as o,J as i,N as d,o as r,ax as m,x as v,n as c}from"./@vue-CFXrvzpc.js";var p=l({name:"vue3-danmaku",components:{},props:{danmus:{type:Array,required:!0,default:()=>[]},channels:{type:Number,default:0},autoplay:{type:Boolean,default:!0},loop:{type:Boolean,default:!1},useSlot:{type:Boolean,default:!1},debounce:{type:Number,default:100},speeds:{type:Number,default:200},randomChannel:{type:Boolean,default:!1},fontSize:{type:Number,default:18},top:{type:Number,default:4},right:{type:Number,default:0},isSuspend:{type:Boolean,default:!1},extraStyle:{type:String,default:""}},emits:["list-end","play-end","dm-over","dm-out","update:danmus"],setup(e,{emit:t,slots:n}){let a=s(document.createElement("div")),l=s(document.createElement("div"));const r=s(0),p=s(0);let f=0;const h=s(0),y=s(0),g=s(0),x=s(!1),b=s(!1),w=s({}),S=function(e,t,n="modelValue"){return u({get:()=>e[n],set:e=>{t(`update:${n}`,e)}})}(e,t,"danmus"),k=o({channels:u((()=>e.channels||h.value)),autoplay:u((()=>e.autoplay)),loop:u((()=>e.loop)),useSlot:u((()=>e.useSlot)),debounce:u((()=>e.debounce)),randomChannel:u((()=>e.randomChannel))}),C=o({height:u((()=>y.value)),fontSize:u((()=>e.fontSize)),speeds:u((()=>e.speeds)),top:u((()=>e.top)),right:u((()=>e.right))});function L(){N(),e.isSuspend&&function(){let e=[];l.value.addEventListener("mouseover",(n=>{let a=n.target;a.className.includes("dm")||(a=a.closest(".dm")||a),a.className.includes("dm")&&(e.includes(a)||(t("dm-over",{el:a}),a.classList.add("pause"),e.push(a)))})),l.value.addEventListener("mouseout",(n=>{let a=n.target;a.className.includes("dm")||(a=a.closest(".dm")||a),a.className.includes("dm")&&(t("dm-out",{el:a}),a.classList.remove("pause"),e.forEach((e=>{e.classList.remove("pause")})),e=[])}))}(),k.autoplay&&E()}function N(){if(r.value=a.value.offsetWidth,p.value=a.value.offsetHeight,0===r.value||0===p.value)throw new Error("获取不到容器宽高")}function E(){b.value=!1,f||(f=window.setInterval((()=>function(){if(!b.value&&S.value.length)if(g.value>S.value.length-1){const e=l.value.children.length;k.loop&&(e<g.value&&(t("list-end"),g.value=0),B())}else B()}()),k.debounce))}function B(a){const s=k.loop?g.value%S.value.length:g.value,u=a||S.value[s];let o=document.createElement("div");var i,d;k.useSlot?o=(i=u,d=s,m({render:()=>v("div",{},[n.dm&&n.dm({danmu:i,index:d})])}).mount(document.createElement("div"))).$el:(o.innerHTML=u,o.setAttribute("style",e.extraStyle),o.style.fontSize=`${C.fontSize}px`,o.style.lineHeight=`${C.fontSize}px`),o.classList.add("dm"),l.value.appendChild(o),o.style.opacity="0",c((()=>{C.height||(y.value=o.offsetHeight),k.channels||(h.value=Math.floor(p.value/(C.height+C.top)));let e=function(e){let t=[...Array(k.channels).keys()];k.randomChannel&&(t=t.sort((()=>.5-Math.random())));for(let n of t){const t=w.value[n];if(!t||!t.length)return w.value[n]=[e],e.addEventListener("animationend",(()=>w.value[n].splice(0,1))),n%k.channels;for(let a=0;a<t.length;a++){const l=$(t[a])-10;if(l<=.88*(e.offsetWidth-t[a].offsetWidth)||l<=0)break;if(a===t.length-1)return w.value[n].push(e),e.addEventListener("animationend",(()=>w.value[n].splice(0,1))),n%k.channels}}return-1}(o);if(e>=0){const n=o.offsetWidth,a=C.height;o.classList.add("move"),o.dataset.index=`${s}`,o.dataset.channel=e.toString(),o.style.opacity="1",o.style.top=e*(a+C.top)+"px",o.style.width=n+C.right+"px",o.style.setProperty("--dm-scroll-width",`-${r.value+n}px`),o.style.left=`${r.value}px`,o.style.animationDuration=r.value/C.speeds+"s",o.addEventListener("animationend",(()=>{Number(o.dataset.index)!==S.value.length-1||k.loop||t("play-end",o.dataset.index),l.value&&l.value.removeChild(o)})),g.value++}else l.value.removeChild(o)}))}function $(e){const t=e.offsetWidth||parseInt(e.style.width),n=e.getBoundingClientRect().right||l.value.getBoundingClientRect().right+t;return l.value.getBoundingClientRect().right-n}function z(){clearInterval(f),f=0,g.value=0}return i((()=>{L()})),d((()=>{z()})),{container:a,dmContainer:l,hidden:x,paused:b,danmuList:S,getPlayState:function(){return!b.value},resize:function(){N();const e=l.value.getElementsByClassName("dm");for(let t=0;t<e.length;t++){const n=e[t];n.style.setProperty("--dm-scroll-width",`-${r.value+n.offsetWidth}px`),n.style.left=`${r.value}px`,n.style.animationDuration=r.value/C.speeds+"s"}},play:E,pause:function(){b.value=!0},stop:function(){w.value={},l.value.innerHTML="",b.value=!0,x.value=!1,z()},show:function(){x.value=!1},hide:function(){x.value=!0},reset:function(){y.value=0,L()},add:function(e){if(g.value===S.value.length)return S.value.push(e),S.value.length-1;{const t=g.value%S.value.length;return S.value.splice(t,0,e),t+1}},push:function(e){return S.value.push(e),S.value.length-1},insert:B}}});const f={ref:"container",class:"vue-danmaku"};!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css","top"===n&&a.firstChild?a.insertBefore(l,a.firstChild):a.appendChild(l),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(document.createTextNode(e))}}(".vue-danmaku {\n  position: relative;\n  overflow: hidden;\n}\n.vue-danmaku .danmus {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n  -webkit-transition: all 0.3s;\n  transition: all 0.3s;\n}\n.vue-danmaku .danmus.show {\n  opacity: 1;\n}\n.vue-danmaku .danmus.paused .dm.move {\n  animation-play-state: paused;\n}\n.vue-danmaku .danmus .dm {\n  position: absolute;\n  font-size: 20px;\n  color: #ddd;\n  white-space: pre;\n  transform: translateX(0);\n  transform-style: preserve-3d;\n}\n.vue-danmaku .danmus .dm.move {\n  will-change: transform;\n  animation-name: moveLeft;\n  animation-timing-function: linear;\n  animation-play-state: running;\n}\n.vue-danmaku .danmus .dm.pause {\n  animation-play-state: paused;\n  z-index: 100;\n}\n@keyframes moveLeft {\n  from {\n    transform: translateX(0);\n  }\n  to {\n    transform: translateX(var(--dm-scroll-width));\n  }\n}\n@-webkit-keyframes moveLeft {\n  from {\n    -webkit-transform: translateX(0);\n  }\n  to {\n    -webkit-transform: translateX(var(--dm-scroll-width));\n  }\n}"),p.render=function(l,s,u,o,i,d){return r(),e("div",f,[t("div",{ref:"dmContainer",class:n(["danmus",{show:!l.hidden},{paused:l.paused}])},null,2),a(l.$slots,"default")],512)},p.__file="src/lib/Danmaku.vue";export{p as f};
