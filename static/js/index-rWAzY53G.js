var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,o=(e,t,a)=>r(e,"symbol"!=typeof t?t+"":t,a);import{e as c}from"./mitt-CI7Qv1RY.js";import{e as h,_ as u}from"./index-DK9WUj9J.js";class l{constructor(e){o(this,"canvas"),o(this,"ctx"),o(this,"images"),o(this,"container"),o(this,"positionX"),o(this,"isDragging"),o(this,"startX"),o(this,"handleClick",(e=>{this.drawTick(e)})),o(this,"handleMouseDown",(e=>{this.startDrag(e.clientX)})),o(this,"handleMouseMove",(e=>{this.drag(e.clientX)})),o(this,"handleMouseUp",(()=>{this.endDrag()})),o(this,"handleTouchStart",(e=>{1===e.touches.length&&(e.preventDefault(),this.startDrag(e.touches[0].clientX))})),o(this,"handleTouchMove",(e=>{1===e.touches.length&&(e.preventDefault(),this.drag(e.touches[0].clientX))})),o(this,"handleTouchEnd",(()=>{this.endDrag()})),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.images=[],this.positionX=0,this.isDragging=!1,this.startX=0,this.container=document.getElementById(e),this.container&&(this.container.appendChild(this.canvas),this.canvas.width=this.container.clientWidth,this.canvas.height=this.container.clientHeight)}addImage(e,t,a,s,i){const n=new Image;n.src=e,this.images.push({img:n,x:t,y:a,width:s,height:i}),this.render()}render(){this.clearRect(),this.images.forEach((e=>{const t=e.x+this.positionX;this.ctx.drawImage(e.img,t,e.y,e.width,e.height)}))}clearImages(){this.images=[]}clearRect(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawTick(e){this.render();const t=Math.ceil((Math.abs(this.positionX)+e.offsetX)/this.images[0].width)-1,a=e.offsetX,s=e.offsetY;this.ctx.strokeStyle="red",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(a-10,s),this.ctx.lineTo(a,s+10),this.ctx.lineTo(a+15,s-10),this.ctx.stroke(),c.emit("imageInfo",this.images[t])}addListener(){this.canvas&&(this.canvas.addEventListener("click",this.handleClick),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("touchstart",this.handleTouchStart),this.canvas.addEventListener("touchmove",this.handleTouchMove),this.canvas.addEventListener("touchend",this.handleTouchEnd))}startDrag(e){this.canvas.style.cursor="grabbing",this.canvas.style.userSelect="none",this.startX=e,this.isDragging=!0}drag(e){if(!this.isDragging)return;const t=e-this.startX,a=this.images.length*this.images[0].width-this.container.clientWidth;this.positionX=Math.max(Math.min(this.positionX+t,0),-a),this.startX=e,this.render()}endDrag(){this.canvas.style.cursor="grab",this.canvas.style.userSelect="auto",this.isDragging=!1}}const d={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APPID:"project-number",VITE_CDN:"true",VITE_COMPRESSION:"none",VITE_HIDE_HOME:"false",VITE_PORT:"8848",VITE_PUBLIC_PATH:"/",VITE_ROUTER_HISTORY:"hash"},V={class:"card-header"},p={class:"font-medium"},m={class:"flex flex-wrap"},g=(e=>(Vue.pushScopeId("data-v-c9074338"),e=e(),Vue.popScopeId(),e))((()=>Vue.createElementVNode("div",{class:"el-upload__text"}," 可拖拽上传视频（默认截取16张帧图片，可在代码中自行修改） ",-1))),v={id:"canvas-container","element-loading-text":"温馨提示：可左右拖拽图片并单击选取所需的帧图片",class:"w-full h-[200px] overflow-hidden mt-6"},f=200,x=Vue.defineComponent((w=((e,t)=>{for(var a in t||(t={}))i.call(t,a)&&r(e,a,t[a]);if(s)for(var a of s(t))n.call(t,a)&&r(e,a,t[a]);return e})({},{name:"VideoFrame"}),t(w,a({__name:"index",setup(e){const t=Vue.ref(""),a=Vue.ref(),s=Vue.ref(),i=Vue.ref(!1),{loadScript:n}=h(),{VITE_PUBLIC_PATH:r}=d,o=e=>`${r}wasm/${e}`,u=o("index.js"),x=o("capture.worker.js"),w=o("capture.worker.wasm");function T(e){return t.value="",i.value=!0,a.value.clearImages(),s.value.then((t=>{t.capture({file:e,info:16,onChange:(e,{url:t})=>{a.value.addImage(t,f*e.url.length,0,f,f)},onSuccess:()=>{a.value.addListener(),a.value.drawTick({offsetX:100,offsetY:100}),i.value=!1},onError:()=>{i.value=!1}})})),!1}return n({src:u}).then((e=>{"加载成功"===e[0].message&&(s.value=cheetahCapture.initCapture({workerPath:x,wasmPath:w}))})),Vue.onMounted((()=>{a.value=new l("canvas-container"),c.on("imageInfo",(e=>t.value=e.img.src))})),Vue.onBeforeUnmount((()=>{c.off("imageInfo")})),(e,a)=>{const s=Vue.resolveComponent("el-link"),n=Vue.resolveComponent("el-upload"),r=Vue.resolveComponent("el-image"),o=Vue.resolveComponent("el-card"),c=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createBlock(o,{shadow:"never"},{header:Vue.withCtx((()=>[Vue.createElementVNode("div",V,[Vue.createElementVNode("span",p,[Vue.createElementVNode("p",null,[Vue.createTextVNode(" 基于自定义编译 "),Vue.createVNode(s,{href:"https://github.com/FFmpeg/FFmpeg",target:"_blank",style:{margin:"0 4px 5px","font-size":"16px"}},{default:Vue.withCtx((()=>[Vue.createTextVNode(" FFmpeg ")])),_:1}),Vue.createTextVNode(" 的截帧工具，支持MP4、MOV、AVI、WebM、MKV等主流格式，支持 H.264（AVC）、H.265（HEVC）、MPEG-2、MPEG-4、VP8、VP9、WMV3编码格式 ")]),Vue.createTextVNode(" 当然还可以支持更多视频格式，只要FFmpeg支持的，按理都能支持，您也可参考 "),Vue.createVNode(s,{href:"https://github.com/wanwu/cheetah-capture",target:"_blank",style:{margin:"0 4px 5px","font-size":"16px"}},{default:Vue.withCtx((()=>[Vue.createTextVNode(" cheetah-capture ")])),_:1}),Vue.createTextVNode(" 和 "),Vue.createVNode(s,{href:"https://github.com/jordiwang/web-capture",target:"_blank",style:{margin:"0 4px 5px","font-size":"16px"}},{default:Vue.withCtx((()=>[Vue.createTextVNode(" web-capture ")])),_:1}),Vue.createTextVNode(" 修改并编译wasm等文件（强烈推荐在Ubuntu系统进行编译） "),Vue.createElementVNode("p",null,[Vue.createTextVNode(" mac系统推荐安装 "),Vue.createVNode(s,{href:"https://github.com/utmapp/UTM",target:"_blank",style:{margin:"0 4px 5px","font-size":"16px"}},{default:Vue.withCtx((()=>[Vue.createTextVNode(" UTM ")])),_:1}),Vue.createTextVNode(" 虚拟机，windows系统推荐安装VMware虚拟机 ")]),Vue.createElementVNode("p",null,[Vue.createTextVNode(" 当然这只是一个视频帧截取工具，如果您想要更多操作可以研究下 "),Vue.createVNode(s,{href:"https://ffmpegwasm.netlify.app/",target:"_blank",style:{margin:"0 4px 5px","font-size":"16px"}},{default:Vue.withCtx((()=>[Vue.createTextVNode(" ffmpeg.wasm ")])),_:1}),Vue.createTextVNode(" ，它是基于 FFmpeg 的纯 WebAssembly / JavaScript 工具，可以在浏览器内进行视频和音频录制、转换和流式传输等，不过通过一些实践，对于时长较长的视频性能还是不太行，不过用于时长较短的短视频还是可以上生产的 ")])]),Vue.createVNode(s,{class:"mt-2",href:"https://github.com/pure-admin/vue-pure-admin/blob/main/src/views/able/video-frame",target:"_blank"},{default:Vue.withCtx((()=>[Vue.createTextVNode(" 代码位置 src/views/able/video-frame ")])),_:1})])])),default:Vue.withCtx((()=>[Vue.createElementVNode("div",m,[Vue.createVNode(n,{drag:"","show-file-list":!1,accept:".mp4,.mov,.avi,.webm,.mkv","before-upload":T},{default:Vue.withCtx((()=>[g])),_:1}),t.value?(Vue.openBlock(),Vue.createBlock(r,{key:0,src:t.value,"preview-src-list":Array.of(t.value),class:"w-[180px] h-[180px] ml-2 rounded-[6px]"},null,8,["src","preview-src-list"])):Vue.createCommentVNode("",!0)]),Vue.withDirectives(Vue.createElementVNode("div",v,null,512),[[c,i.value]])])),_:1})}}}))));var w;const T=u(x,[["__scopeId","data-v-c9074338"]]);export{T as default};
