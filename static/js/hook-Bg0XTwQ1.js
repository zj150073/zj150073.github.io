var e=(e,t,a)=>new Promise(((l,n)=>{var r=e=>{try{u(a.next(e))}catch(t){n(t)}},o=e=>{try{u(a.throw(e))}catch(t){n(t)}},u=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,o);u((a=a.apply(e,t)).next())}));import{_ as t}from"./form.vue_vue_type_script_setup_true_lang-BqyLoetM.js";import{r as a,aI as l,t as n,m as r,l as o,f as u}from"./index-DK9WUj9J.js";import{u as s}from"./hooks-siYFZ-vN.js";import{h as i,i as c,j as d}from"./system-CZHEA98f.js";function v(v){const f=Vue.reactive({name:"",code:"",status:""}),m=Vue.ref(),p=Vue.ref(),h=Vue.ref([]),g=Vue.ref([]),y=Vue.ref([]),V=Vue.ref(!1),w=Vue.ref(!0),b=Vue.ref(!1),x=Vue.ref(),S=Vue.ref({}),k=Vue.ref(!1),C=Vue.ref(!1),{switchStyle:$}=s(),j=Vue.reactive({total:0,pageSize:10,currentPage:1,background:!0}),M=[{label:"角色编号",prop:"id"},{label:"角色名称",prop:"name"},{label:"角色标识",prop:"code"},{label:"状态",cellRenderer:e=>{var t;return Vue.createVNode(Vue.resolveComponent("el-switch"),{size:"small"===e.props.size?"small":"default",loading:null==(t=S.value[e.index])?void 0:t.loading,modelValue:e.row.status,"onUpdate:modelValue":t=>e.row.status=t,"active-value":1,"inactive-value":0,"active-text":"已启用","inactive-text":"已停用","inline-prompt":!0,style:$.value,onChange:()=>function({row:e,index:t}){ElementPlus.ElMessageBox.confirm(`确认要<strong>${0===e.status?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.name}</strong>吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then((()=>{S.value[t]=Object.assign({},S.value[t],{loading:!0}),setTimeout((()=>{S.value[t]=Object.assign({},S.value[t],{loading:!1}),r(`已${0===e.status?"停用":"启用"}${e.name}`,{type:"success"})}),300)})).catch((()=>{0===e.status?e.status=1:e.status=0}))}(e)},null)},minWidth:90},{label:"备注",prop:"remark",minWidth:160},{label:"创建时间",prop:"createTime",minWidth:160,formatter:({createTime:e})=>dayjs(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:210,slot:"operation"}];function P(){return e(this,null,(function*(){w.value=!0;const{data:e}=yield c(Vue.toRaw(f));h.value=e.list,j.total=e.total,j.pageSize=e.pageSize,j.currentPage=e.currentPage,setTimeout((()=>{w.value=!1}),500)}))}return Vue.onMounted((()=>e(this,null,(function*(){P();const{data:e}=yield i();g.value=a(e,"id"),y.value=l(e)})))),Vue.watch(k,(e=>{e?v.value.setExpandedKeys(g.value):v.value.setExpandedKeys([])})),Vue.watch(C,(e=>{e?v.value.setCheckedKeys(g.value):v.value.setCheckedKeys([])})),{form:f,isShow:V,curRow:m,loading:w,columns:M,rowStyle:function({row:{id:e}}){var t;return{cursor:"pointer",background:e===(null==(t=m.value)?void 0:t.id)?"var(--el-fill-color-light)":""}},dataList:h,treeData:y,treeProps:{value:"id",label:"title",children:"children"},isLinkage:b,pagination:j,isExpandAll:k,isSelectAll:C,treeSearchValue:x,onSearch:P,resetForm:e=>{e&&(e.resetFields(),P())},openDialog:function(e="新增",a){var l,n,s;o({title:`${e}角色`,props:{formInline:{name:null!=(l=null==a?void 0:a.name)?l:"",code:null!=(n=null==a?void 0:a.code)?n:"",remark:null!=(s=null==a?void 0:a.remark)?s:""}},width:"40%",draggable:!0,fullscreen:u(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>Vue.h(t,{ref:p}),beforeSure:(t,{options:a})=>{const l=p.value.getRef(),n=a.props.formInline;function o(){r(`您${e}了角色名称为${n.name}的这条数据`,{type:"success"}),t(),P()}l.validate((e=>{e&&o()}))}})},handleMenu:function(t){return e(this,null,(function*(){const{id:e}=t;if(e){m.value=t,V.value=!0;const{data:a}=yield d({id:e});v.value.setCheckedKeys(a)}else m.value=null,V.value=!1}))},handleSave:function(){const{id:e,name:t}=m.value;r(`角色名称为${t}的菜单权限修改成功`,{type:"success"})},handleDelete:function(e){r(`您删除了角色名称为${e.name}的这条数据`,{type:"success"}),P()},filterMethod:(e,t)=>n(t.title).includes(e),transformI18n:n,onQueryChanged:e=>{v.value.filter(e)},handleSizeChange:function(e){},handleCurrentChange:function(e){},handleSelectionChange:function(e){}}}export{v as useRole};
