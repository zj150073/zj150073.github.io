var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(l,a,o)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o;import{f as n}from"./mock-CRIhzlfN.js";import{d as u,a as i,r as c,g2 as d,e as m,f as p,k as f,i as v,w as b,u as h,h as y,g,$ as w,v as _,aG as V,L as k}from"./index-CKXHolY4.js";import{R as x}from"./index-B2ThFQuw.js";import{d as O}from"./upload-line-D6XAvwvG.js";const j=g("h3",{class:"my-8"},"个人信息",-1),P=g("span",{class:"ml-2"},"更新头像",-1),R={class:"dialog-footer"},C=u((U=((e,l)=>{for(var a in l||(l={}))t.call(l,a)&&s(e,a,l[a]);if(o)for(var a of o(l))r.call(l,a)&&s(e,a,l[a]);return e})({},{name:"Profile"}),l(U,a({__name:"Profile",setup(e){const l=i(""),a=i(),o=i(),t=i(),r=i(!1),s=i(),u=c({avatar:"",nickname:"",email:"",phone:"",description:""}),C=c({nickname:[{required:!0,message:"昵称必填",trigger:"blur"}]});function U(e,l){let a=[],o=[];[{value:"@qq.com"},{value:"@126.com"},{value:"@163.com"}].map((l=>o.push({value:e.split("@")[0]+l.value}))),a=e?o.filter((l=>0===l.value.toLowerCase().indexOf(e.toLowerCase()))):o,l(a)}const F=e=>{const a=new FileReader;a.onload=e=>{l.value=e.target.result,r.value=!0},a.readAsDataURL(e.raw)},I=()=>{o.value.hidePopover(),t.value.clearFiles(),r.value=!1},L=({blob:e})=>a.value=e,q=()=>{const e=V({files:new File([a.value],"avatar")});n(e).then((({success:e,data:l})=>{e?(k("更新头像成功",{type:"success"}),I()):k("更新头像失败")})).catch((e=>{k(`提交异常 ${e}`,{type:"error"})}))},S=e=>{return l=this,a=null,o=function*(){yield e.validate(((e,l)=>{e&&k("更新信息成功",{type:"success"})}))},new Promise(((e,t)=>{var r=e=>{try{n(o.next(e))}catch(l){t(l)}},s=e=>{try{n(o.throw(e))}catch(l){t(l)}},n=l=>l.done?e(l.value):Promise.resolve(l.value).then(r,s);n((o=o.apply(l,a)).next())}));var l,a,o};return d().then((e=>{Object.assign(u,e.data)})),(e,a)=>{const n=m("el-avatar"),i=m("IconifyIconOffline"),c=m("el-button"),d=m("el-upload"),V=m("el-form-item"),k=m("el-input"),z=m("el-autocomplete"),D=m("el-form"),$=m("el-dialog");return p(),f("div",{class:_(["min-w-[180px]",h(w)()?"max-w-[100%]":"max-w-[70%]"])},[j,v(D,{ref_key:"userInfoFormRef",ref:s,"label-position":"top",rules:C,model:u},{default:b((()=>[v(V,{label:"头像"},{default:b((()=>[v(n,{size:80,src:u.avatar},null,8,["src"]),v(d,{ref_key:"uploadRef",ref:t,accept:"image/*",action:"#",limit:1,"auto-upload":!1,"show-file-list":!1,"on-change":F},{default:b((()=>[v(c,{plain:"",class:"ml-4"},{default:b((()=>[v(i,{icon:h(O)},null,8,["icon"]),P])),_:1})])),_:1},512)])),_:1}),v(V,{label:"昵称",prop:"nickname"},{default:b((()=>[v(k,{modelValue:u.nickname,"onUpdate:modelValue":a[0]||(a[0]=e=>u.nickname=e),placeholder:"请输入昵称"},null,8,["modelValue"])])),_:1}),v(V,{label:"邮箱",prop:"email"},{default:b((()=>[v(z,{modelValue:u.email,"onUpdate:modelValue":a[1]||(a[1]=e=>u.email=e),"fetch-suggestions":U,"trigger-on-focus":!1,placeholder:"请输入邮箱",clearable:"",class:"w-full"},null,8,["modelValue"])])),_:1}),v(V,{label:"联系电话"},{default:b((()=>[v(k,{modelValue:u.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>u.phone=e),placeholder:"请输入联系电话",clearable:""},null,8,["modelValue"])])),_:1}),v(V,{label:"简介"},{default:b((()=>[v(k,{modelValue:u.description,"onUpdate:modelValue":a[3]||(a[3]=e=>u.description=e),placeholder:"请输入简介",type:"textarea",autosize:{minRows:6,maxRows:8},maxlength:"56","show-word-limit":""},null,8,["modelValue"])])),_:1}),v(c,{type:"primary",onClick:a[4]||(a[4]=e=>S(s.value))},{default:b((()=>[y(" 更新信息 ")])),_:1})])),_:1},8,["rules","model"]),v($,{modelValue:r.value,"onUpdate:modelValue":a[5]||(a[5]=e=>r.value=e),width:"40%",title:"编辑头像","destroy-on-close":"",closeOnClickModal:!1,"before-close":I,fullscreen:h(w)()},{footer:b((()=>[g("div",R,[v(c,{bg:"",text:"",onClick:I},{default:b((()=>[y("取消")])),_:1}),v(c,{bg:"",text:"",type:"primary",onClick:q},{default:b((()=>[y(" 确定 ")])),_:1})])])),default:b((()=>[v(h(x),{ref_key:"cropRef",ref:o,imgSrc:l.value,onCropper:L},null,8,["imgSrc"])])),_:1},8,["modelValue","fullscreen"])],2)}}}))));var U;export{C as _};
