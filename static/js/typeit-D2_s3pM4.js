var t,e,i,s,n,r,l,o,a,u,h,c,d,f,p,m,y,b,g,v,P,T,w,S,C,E,q=Object.defineProperty,I=Object.defineProperties,N=Object.getOwnPropertyDescriptors,L=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,O=t=>{throw TypeError(t)},M=(t,e,i)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,A=(t,e)=>{for(var i in e||(e={}))x.call(e,i)&&M(t,i,e[i]);if(L)for(var i of L(e))D.call(e,i)&&M(t,i,e[i]);return t},$=(t,e,i)=>M(t,"symbol"!=typeof e?e+"":e,i),k=(t,e,i)=>e.has(t)||O("Cannot "+i),H=(t,e,i)=>(k(t,e,"read from private field"),i?i.call(t):e.get(t)),z=(t,e,i)=>e.has(t)?O("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),F=(t,e,i)=>(k(t,e,"access private method"),i),j=(t,e,i)=>new Promise(((s,n)=>{var r=t=>{try{o(i.next(t))}catch(e){n(e)}},l=t=>{try{o(i.throw(t))}catch(e){n(e)}},o=t=>t.done?s(t.value):Promise.resolve(t.value).then(r,l);o((i=i.apply(t,e)).next())}));const R=t=>Array.isArray(t),B=t=>R(t)?t:[t];const _="data-typeit-id",W="ti-cursor",U={started:!1,completed:!1,frozen:!1,destroyed:!1},V={breakLines:!0,cursor:{autoPause:!0,autoPauseDelay:500,animation:{frames:[0,0,1].map((t=>({opacity:t}))),options:{iterations:1/0,easing:"steps(2, start)",fill:"forwards"}}},cursorChar:"|",cursorSpeed:1e3,deleteSpeed:null,html:!0,lifeLike:!0,loop:!1,loopDelay:750,nextStringDelay:750,speed:100,startDelay:250,startDelete:!1,strings:[],waitUntilVisible:!1,beforeString:()=>{},afterString:()=>{},beforeStep:()=>{},afterStep:()=>{},afterComplete:()=>{}},Q=`[${_}]:before {content: '.'; display: inline-block; width: 0; visibility: hidden;}`,J=t=>document.createElement(t),X=t=>document.createTextNode(t),G=(t,e="")=>{let i=J("style");i.id=e,i.appendChild(X(t)),document.head.appendChild(i)},K=t=>(R(t)||(t=[t/2,t/2]),t),Y=(t,e)=>Math.abs(Math.random()*(t+e-(t-e))+(t-e));let Z=t=>t/2;const tt=t=>Array.from(t);let et=t=>([...t.childNodes].forEach((t=>{if(t.nodeValue)return[...t.nodeValue].forEach((e=>{t.parentNode.insertBefore(X(e),t)})),void t.remove();et(t)})),t);const it=t=>{let e=document.implementation.createHTMLDocument();return e.body.innerHTML=t,et(e.body)};function st(t,e=!1,i=!1){let s,n=t.querySelector(`.${W}`),r=document.createTreeWalker(t,NodeFilter.SHOW_ALL,{acceptNode:t=>{var e,s;if(n&&i){if(null==(e=t.classList)?void 0:e.contains(W))return NodeFilter.FILTER_ACCEPT;if(n.contains(t))return NodeFilter.FILTER_REJECT}return(null==(s=t.classList)?void 0:s.contains(W))?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),l=[];for(;s=r.nextNode();)s.originalParent||(s.originalParent=s.parentNode),l.push(s);return e?l.reverse():l}function nt(t,e=!0){return e?st(it(t)):tt(t).map(X)}const rt=({index:t,newIndex:e,queueItems:i,cleanUp:s})=>{for(let n=t+1;n<e+1;n++)s(i[n][0])},lt=t=>Number.isInteger(t),ot=({queueItems:t,selector:e,cursorPosition:i,to:s})=>{if(lt(e))return-1*e;let n=new RegExp("END","i").test(s),r=e?[...t].reverse().findIndex((({char:t})=>{let i=t.parentElement,s=i.matches(e);return!(!n||!s)||s&&i.firstChild.isSameNode(t)})):-1;return r<0&&(r=n?0:t.length-1),r-i+(n?0:1)},at=(t,e)=>new Array(e).fill(t);let ut=t=>new Promise((e=>{requestAnimationFrame((()=>j(void 0,null,(function*(){e(yield t())}))))})),ht=t=>null==t?void 0:t.getAnimations().find((e=>e.id===t.dataset.tiAnimationId)),ct=({cursor:t,frames:e,options:i})=>{let s=t.animate(e,i);return s.pause(),s.id=t.dataset.tiAnimationId,ut((()=>{ut((()=>{s.play()}))})),s},dt=t=>{var e;return null==(e=t.func)?void 0:e.call(null)},ft=t=>j(void 0,[t],(function*({index:t,queueItems:e,wait:i,cursor:s,cursorOptions:n}){let r=e[t][1],l=[],o=t,a=r,u=()=>a&&!a.delay,h=r.shouldPauseCursor()&&n.autoPause;for(;u();)l.push(a),u()&&o++,a=e[o]?e[o][1]:null;if(l.length)return yield ut((()=>j(void 0,null,(function*(){for(let t of l)yield dt(t)})))),o-1;let c,d=ht(s);var f,p;return d&&(f=A({},d.effect.getComputedTiming()),p={delay:h?n.autoPauseDelay:0},c=I(f,N(p))),yield i((()=>j(void 0,null,(function*(){d&&h&&d.cancel(),yield ut((()=>{dt(r)}))}))),r.delay),yield(({cursor:t,options:e,cursorOptions:i})=>{if(!t||!i)return;let s,n=ht(t);n&&(e.delay=n.effect.getComputedTiming().delay,s=n.currentTime,n.cancel());let r=ct({cursor:t,frames:i.animation.frames,options:e});return s&&(r.currentTime=s),r})({cursor:s,options:c,cursorOptions:n}),t}));const pt=t=>"value"in t;let mt=t=>"function"==typeof t?t():t,yt=(t,e=document,i=!1)=>e["querySelector"+(i?"All":"")](t);const bt=(t,e)=>Object.assign({},t,e);let gt={"font-family":"","font-weight":"","font-size":"","font-style":"","line-height":"",color:"",transform:"translateX(-.125em)"};class vt{constructor(e,i={}){var s;z(this,t),$(this,"element"),$(this,"timeouts"),$(this,"cursorPosition"),$(this,"predictedCursorPosition"),$(this,"statuses",{started:!1,completed:!1,frozen:!1,destroyed:!1}),$(this,"opts"),$(this,"id"),$(this,"queue"),$(this,"cursor"),$(this,"unfreeze",(()=>{})),$(this,"is",(function(t){return this.statuses[t]})),z(this,p,(e=>{var i;e.cursor=(t=>{var e,i,s;if("object"==typeof t){let n={},{frames:r,options:l}=V.cursor.animation;return n.animation=t.animation||{},n.animation.frames=(null==(e=t.animation)?void 0:e.frames)||r,n.animation.options=bt(l,(null==(i=t.animation)?void 0:i.options)||{}),n.autoPause=null!=(s=t.autoPause)?s:V.cursor.autoPause,n.autoPauseDelay=t.autoPauseDelay||V.cursor.autoPauseDelay,n}return!0===t?V.cursor:t})(null!=(i=e.cursor)?i:V.cursor),this.opts.strings=F(this,t,m).call(this,B(this.opts.strings)),this.opts=bt(this.opts,{html:!H(this,t,S)&&this.opts.html,nextStringDelay:K(this.opts.nextStringDelay),loopDelay:K(this.opts.loopDelay)})})),this.opts=bt(V,i),this.element="string"==typeof(s=e)?yt(s):s,this.timeouts=[],this.cursorPosition=0,this.unfreeze=()=>{},this.predictedCursorPosition=null,this.statuses=bt({},U),this.id=Math.random().toString().substring(2,9),this.queue=function(t){let e=function(t){return B(t).forEach((t=>{var e;return n.set(Symbol(null==(e=t.char)?void 0:e.innerText),i(A({},t)))})),this},i=t=>(t.shouldPauseCursor=function(){return Boolean(this.typeable||this.cursorable||this.deletable)},t),s=()=>Array.from(n.values()),n=new Map;return e(t),{add:e,set:function(t,e){let s=[...n.keys()];n.set(s[t],i(e))},wipe:function(){n=new Map,e(t)},done:(t,e=!1)=>e?n.delete(t):n.get(t).done=!0,reset:function(){n.forEach((t=>delete t.done))},destroy:t=>n.delete(t),getItems:(t=!1)=>t?s():s().filter((t=>!t.done)),getQueue:()=>n,getTypeable:()=>s().filter((t=>t.typeable))}}([{delay:this.opts.startDelay}]),H(this,p).call(this,i),this.cursor=F(this,t,y).call(this),this.element.dataset.typeitId=this.id,G(Q),this.opts.strings.length&&F(this,t,f).call(this)}go(){return this.statuses.started?this:(F(this,t,o).call(this),this.opts.waitUntilVisible?(e=this.element,s=F(this,t,i).bind(this),new IntersectionObserver(((t,i)=>{t.forEach((t=>{t.isIntersecting&&(s(),i.unobserve(e))}))}),{threshold:1}).observe(e),this):(F(this,t,i).call(this),this));var e,s}destroy(e=!0){this.timeouts=(this.timeouts.forEach(clearTimeout),[]),mt(e)&&this.cursor&&F(this,t,P).call(this,this.cursor),this.statuses.destroyed=!0}reset(e){!this.is("destroyed")&&this.destroy(),e?(this.queue.wipe(),e(this)):this.queue.reset(),this.cursorPosition=0;for(let t in this.statuses)this.statuses[t]=!1;return this.element[F(this,t,a).call(this)?"value":"innerHTML"]="",this}type(e,i={}){e=mt(e);let{instant:s}=i,n=F(this,t,c).call(this,i),r=nt(e,this.opts.html).map((e=>{return{func:()=>F(this,t,g).call(this,e),char:e,delay:s||(i=e,/<(.+)>(.*?)<\/(.+)>/.test(i.outerHTML))?0:F(this,t,T).call(this),typeable:e.nodeType===Node.TEXT_NODE};var i})),l=[n[0],{func:()=>j(this,null,(function*(){return yield this.opts.beforeString(e,this)}))},...r,{func:()=>j(this,null,(function*(){return yield this.opts.afterString(e,this)}))},n[1]];return F(this,t,u).call(this,l,i)}break(e={}){return F(this,t,u).call(this,{func:()=>F(this,t,g).call(this,J("BR")),typeable:!0},e)}move(e,i={}){e=mt(e);let n=F(this,t,c).call(this,i),{instant:r,to:l}=i,o=ot({queueItems:this.queue.getTypeable(),selector:null===e?"":e,to:l,cursorPosition:H(this,t,w)}),a=o<0?-1:1;return this.predictedCursorPosition=H(this,t,w)+o,F(this,t,u).call(this,[n[0],...at({func:()=>F(this,t,s).call(this,a),delay:r?0:F(this,t,T).call(this),cursorable:!0},Math.abs(o)),n[1]],i)}exec(e,i={}){let s=F(this,t,c).call(this,i);return F(this,t,u).call(this,[s[0],{func:()=>e(this)},s[1]],i)}options(e,i={}){return e=mt(e),F(this,t,d).call(this,e),F(this,t,u).call(this,{},i)}pause(e,i={}){return F(this,t,u).call(this,{delay:mt(e)},i)}delete(e=null,i={}){e=mt(e);let s=F(this,t,c).call(this,i),n=e,{instant:r,to:l}=i,o=this.queue.getTypeable(),a=(()=>null===n?o.length:lt(n)?n:ot({queueItems:o,selector:n,cursorPosition:H(this,t,w),to:l}))();return F(this,t,u).call(this,[s[0],...at({func:F(this,t,v).bind(this),delay:r?0:F(this,t,T).call(this,1),deletable:!0},a),s[1]],i)}freeze(){this.statuses.frozen=!0}flush(e=()=>{}){return F(this,t,o).call(this),F(this,t,i).call(this,!1).then(e),this}getQueue(){return this.queue}getOptions(){return this.opts}updateOptions(e){return F(this,t,d).call(this,e)}getElement(){return this.element}empty(i={}){return F(this,t,u).call(this,{func:F(this,t,e).bind(this)},i)}}t=new WeakSet,e=function(){return j(this,null,(function*(){F(this,t,a).call(this)?this.element.value="":H(this,t,E).forEach(F(this,t,P).bind(this))}))},i=function(e=!0){return j(this,null,(function*(){this.statuses.started=!0;let s=t=>{this.queue.done(t,!e)};try{let o=[...this.queue.getQueue()];for(let e=0;e<o.length;e++){let[i,n]=o[e];if(!n.done){if(!n.deletable||n.deletable&&H(this,t,E).length){let i=yield F(this,t,r).call(this,e,o);rt({index:e,newIndex:i,queueItems:o,cleanUp:s}),e=i}s(i)}}if(!e)return this;if(this.statuses.completed=!0,yield this.opts.afterComplete(this),!this.opts.loop)throw"";let a=this.opts.loopDelay;F(this,t,l).call(this,(()=>j(this,null,(function*(){yield F(this,t,n).call(this,a[0]),F(this,t,i).call(this)}))),a[1])}catch(o){}return this}))},s=function(e){return j(this,null,(function*(){var i,s,n;this.cursorPosition=(i=e,s=this.cursorPosition,n=H(this,t,E),Math.min(Math.max(s+i,0),n.length)),((t,e,i)=>{let s=e[i-1],n=yt(`.${W}`,t);(t=(null==s?void 0:s.parentNode)||t).insertBefore(n,s||null)})(this.element,H(this,t,E),this.cursorPosition)}))},n=function(e){return j(this,null,(function*(){let i=H(this,t,w);i&&(yield F(this,t,s).call(this,{value:i}));let n=H(this,t,E).map((e=>[Symbol(),{func:F(this,t,v).bind(this),delay:F(this,t,T).call(this,1),deletable:!0,shouldPauseCursor:()=>!0}]));for(let e=0;e<n.length;e++)yield F(this,t,r).call(this,e,n);this.queue.reset(),this.queue.set(0,{delay:e})}))},r=function(e,i){return ft({index:e,queueItems:i,wait:F(this,t,l).bind(this),cursor:this.cursor,cursorOptions:this.opts.cursor})},l=function(t,e,i=!1){return j(this,null,(function*(){this.statuses.frozen&&(yield new Promise((t=>{this.unfreeze=()=>{this.statuses.frozen=!1,t()}}))),i||(yield this.opts.beforeStep(this)),yield((t,e,i)=>new Promise((s=>{i.push(setTimeout((()=>j(void 0,null,(function*(){yield t(),s()}))),e||0))})))(t,e,this.timeouts),i||(yield this.opts.afterStep(this))}))},o=function(){return j(this,null,(function*(){if(!F(this,t,a).call(this)&&this.cursor&&this.element.appendChild(this.cursor),H(this,t,C)){((t,e)=>{let i=`[${_}='${t}'] .${W}`,s=getComputedStyle(e),n=Object.entries(gt).reduce(((t,[e,i])=>`${t} ${e}: var(--ti-cursor-${e}, ${i||s[e]});`),"");G(`${i} { display: inline-block; width: 0; ${n} }`,t)})(this.id,this.element),this.cursor.dataset.tiAnimationId=this.id;let{animation:t}=this.opts.cursor,{frames:e,options:i}=t;ct({frames:e,cursor:this.cursor,options:A({duration:this.opts.cursorSpeed},i)})}}))},a=function(){return pt(this.element)},u=function(e,i){return this.queue.add(e),F(this,t,h).call(this,i),this},h=function(t={}){let e=t.delay;e&&this.queue.add({delay:e})},c=function(e={}){return[{func:()=>F(this,t,d).call(this,e)},{func:()=>F(this,t,d).call(this,this.opts)}]},d=function(t){return j(this,null,(function*(){this.opts=bt(this.opts,t)}))},f=function(){let e=this.opts.strings.filter((t=>!!t));e.forEach(((i,s)=>{if(this.type(i),s+1===e.length)return;let n=this.opts.breakLines?[{func:()=>F(this,t,g).call(this,J("BR")),typeable:!0}]:at({func:F(this,t,v).bind(this),delay:F(this,t,T).call(this,1)},this.queue.getTypeable().length);F(this,t,b).call(this,n)}))},p=new WeakMap,m=function(e){let i=this.element.innerHTML;return i?(this.element.innerHTML="",this.opts.startDelete?(this.element.innerHTML=i,et(this.element),F(this,t,b).call(this,at({func:F(this,t,v).bind(this),delay:F(this,t,T).call(this,1),deletable:!0},H(this,t,E).length)),e):(s=i,s.replace(/<!--(.+?)-->/g,"").trim().split(/<br(?:\s*?)(?:\/)?>/)).concat(e)):e;var s},y=function(){if(H(this,t,S))return null;let e=J("span");return e.className=W,H(this,t,C)?(e.innerHTML=it(this.opts.cursorChar).innerHTML,e):(e.style.visibility="hidden",e)},b=function(t){let e=this.opts.nextStringDelay;this.queue.add([{delay:e[0]},...t,{delay:e[1]}])},g=function(t){((t,e)=>{if(pt(t))return void(t.value=`${t.value}${e.textContent}`);e.innerHTML="";let i=(s=e.originalParent,/body/i.test(null==s?void 0:s.tagName)?t:e.originalParent||t);var s;i.insertBefore(e,yt("."+W,i)||null)})(this.element,t)},v=function(){H(this,t,E).length&&(H(this,t,S)?this.element.value=this.element.value.slice(0,-1):F(this,t,P).call(this,H(this,t,E)[this.cursorPosition]))},P=function(t){((t,e)=>{if(!t)return;let i=t.parentNode;(i.childNodes.length>1||i.isSameNode(e)?t:i).remove()})(t,this.element)},T=function(t=0){return function(t){let{speed:e,deleteSpeed:i,lifeLike:s}=t;return i=null!==i?i:e/3,s?[Y(e,Z(e)),Y(i,Z(i))]:[e,i]}(this.opts)[t]},w=function(){var t;return null!=(t=this.predictedCursorPosition)?t:this.cursorPosition},S=function(){return pt(this.element)},C=function(){return!!this.opts.cursor&&!H(this,t,S)},E=function(){return t=this.element,pt(t)?tt(t.value):st(t,!0).filter((t=>!(t.childNodes.length>0)));var t};export{vt as T};
