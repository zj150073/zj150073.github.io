var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,h=(e,t,a)=>r(e,"symbol"!=typeof t?t+"":t,a);import{e as c}from"./mitt-CI7Qv1RY.js";import{d as o,a as l,a3 as d,m as u,z as p,b as g,w as m,e as v,A as f,f as w,g as x,h as b,i as _,j as E,B as y,C as I,D as M,_ as T}from"./index-Doj-dlYt.js";class D{constructor(e){h(this,"canvas"),h(this,"ctx"),h(this,"images"),h(this,"container"),h(this,"positionX"),h(this,"isDragging"),h(this,"startX"),h(this,"handleClick",(e=>{this.drawTick(e)})),h(this,"handleMouseDown",(e=>{this.startDrag(e.clientX)})),h(this,"handleMouseMove",(e=>{this.drag(e.clientX)})),h(this,"handleMouseUp",(()=>{this.endDrag()})),h(this,"handleTouchStart",(e=>{1===e.touches.length&&(e.preventDefault(),this.startDrag(e.touches[0].clientX))})),h(this,"handleTouchMove",(e=>{1===e.touches.length&&(e.preventDefault(),this.drag(e.touches[0].clientX))})),h(this,"handleTouchEnd",(()=>{this.endDrag()})),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.images=[],this.positionX=0,this.isDragging=!1,this.startX=0,this.container=document.getElementById(e),this.container&&(this.container.appendChild(this.canvas),this.canvas.width=this.container.clientWidth,this.canvas.height=this.container.clientHeight)}addImage(e,t,a,s,i){const n=new Image;n.src=e,this.images.push({img:n,x:t,y:a,width:s,height:i}),this.render()}render(){this.clearRect(),this.images.forEach((e=>{const t=e.x+this.positionX;this.ctx.drawImage(e.img,t,e.y,e.width,e.height)}))}clearImages(){this.images=[]}clearRect(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawTick(e){this.render();const t=Math.ceil((Math.abs(this.positionX)+e.offsetX)/this.images[0].width)-1,a=e.offsetX,s=e.offsetY;this.ctx.strokeStyle="red",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(a-10,s),this.ctx.lineTo(a,s+10),this.ctx.lineTo(a+15,s-10),this.ctx.stroke(),c.emit("imageInfo",this.images[t])}addListener(){this.canvas&&(this.canvas.addEventListener("click",this.handleClick),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("touchstart",this.handleTouchStart),this.canvas.addEventListener("touchmove",this.handleTouchMove),this.canvas.addEventListener("touchend",this.handleTouchEnd))}startDrag(e){this.canvas.style.cursor="grabbing",this.canvas.style.userSelect="none",this.startX=e,this.isDragging=!0}drag(e){if(!this.isDragging)return;const t=e-this.startX,a=this.images.length*this.images[0].width-this.container.clientWidth;this.positionX=Math.max(Math.min(this.positionX+t,0),-a),this.startX=e,this.render()}endDrag(){this.canvas.style.cursor="grab",this.canvas.style.userSelect="auto",this.isDragging=!1}}const P={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APPID:"project-number",VITE_CDN:"false",VITE_COMPRESSION:"none",VITE_HIDE_HOME:"false",VITE_PORT:"8848",VITE_PUBLIC_PATH:"/",VITE_ROUTER_HISTORY:"hash"},k={class:"card-header"},V={class:"font-medium"},O={class:"flex flex-wrap"},X=(e=>(I("data-v-c9074338"),e=e(),M(),e))((()=>x("div",{class:"el-upload__text"}," 可拖拽上传视频（默认截取16张帧图片，可在代码中自行修改） ",-1))),C={id:"canvas-container","element-loading-text":"温馨提示：可左右拖拽图片并单击选取所需的帧图片",class:"w-full h-[200px] overflow-hidden mt-6"},S=200,j=o((L=((e,t)=>{for(var a in t||(t={}))i.call(t,a)&&r(e,a,t[a]);if(s)for(var a of s(t))n.call(t,a)&&r(e,a,t[a]);return e})({},{name:"VideoFrame"}),t(L,a({__name:"index",setup(e){const t=l(""),a=l(),s=l(),i=l(!1),{loadScript:n}=d(),{VITE_PUBLIC_PATH:r}=P,h=e=>`${r}wasm/${e}`,o=h("index.js"),I=h("capture.worker.js"),M=h("capture.worker.wasm");function T(e){return t.value="",i.value=!0,a.value.clearImages(),s.value.then((t=>{t.capture({file:e,info:16,onChange:(e,{url:t})=>{a.value.addImage(t,S*e.url.length,0,S,S)},onSuccess:()=>{a.value.addListener(),a.value.drawTick({offsetX:100,offsetY:100}),i.value=!1},onError:()=>{i.value=!1}})})),!1}return n({src:o}).then((e=>{"加载成功"===e[0].message&&(s.value=cheetahCapture.initCapture({workerPath:I,wasmPath:M}))})),u((()=>{a.value=new D("canvas-container"),c.on("imageInfo",(e=>t.value=e.img.src))})),p((()=>{c.off("imageInfo")})),(e,a)=>{const s=v("el-link"),n=v("el-upload"),r=v("el-image"),h=v("el-card"),c=f("loading");return w(),g(h,{shadow:"never"},{header:m((()=>[x("div",k,[x("span",V,[x("p",null,[b(" 基于自定义编译 "),_(s,{href:"https://github.com/FFmpeg/FFmpeg",target:"_blank",style:{margin:"0 4px 5px","font-size":"16px"}},{default:m((()=>[b(" FFmpeg ")])),_:1}),b(" 的截帧工具，支持MP4、MOV、AVI、WebM、MKV等主流格式，支持 H.264（AVC）、H.265（HEVC）、MPEG-2、MPEG-4、VP8、VP9、WMV3编码格式 ")]),b(" 当然还可以支持更多视频格式，只要FFmpeg支持的，按理都能支持，您也可参考 "),_(s,{href:"https://github.com/wanwu/cheetah-capture",target:"_blank",style:{margin:"0 4px 5px","font-size":"16px"}},{default:m((()=>[b(" cheetah-capture ")])),_:1}),b(" 和 "),_(s,{href:"https://github.com/jordiwang/web-capture",target:"_blank",style:{margin:"0 4px 5px","font-size":"16px"}},{default:m((()=>[b(" web-capture ")])),_:1}),b(" 修改并编译wasm等文件（强烈推荐在Ubuntu系统进行编译） "),x("p",null,[b(" mac系统推荐安装 "),_(s,{href:"https://github.com/utmapp/UTM",target:"_blank",style:{margin:"0 4px 5px","font-size":"16px"}},{default:m((()=>[b(" UTM ")])),_:1}),b(" 虚拟机，windows系统推荐安装VMware虚拟机 ")]),x("p",null,[b(" 当然这只是一个视频帧截取工具，如果您想要更多操作可以研究下 "),_(s,{href:"https://ffmpegwasm.netlify.app/",target:"_blank",style:{margin:"0 4px 5px","font-size":"16px"}},{default:m((()=>[b(" ffmpeg.wasm ")])),_:1}),b(" ，它是基于 FFmpeg 的纯 WebAssembly / JavaScript 工具，可以在浏览器内进行视频和音频录制、转换和流式传输等，不过通过一些实践，对于时长较长的视频性能还是不太行，不过用于时长较短的短视频还是可以上生产的 ")])]),_(s,{class:"mt-2",href:"https://github.com/pure-admin/vue-pure-admin/blob/main/src/views/able/video-frame",target:"_blank"},{default:m((()=>[b(" 代码位置 src/views/able/video-frame ")])),_:1})])])),default:m((()=>[x("div",O,[_(n,{drag:"","show-file-list":!1,accept:".mp4,.mov,.avi,.webm,.mkv","before-upload":T},{default:m((()=>[X])),_:1}),t.value?(w(),g(r,{key:0,src:t.value,"preview-src-list":Array.of(t.value),class:"w-[180px] h-[180px] ml-2 rounded-[6px]"},null,8,["src","preview-src-list"])):E("",!0)]),y(x("div",C,null,512),[[c,i.value]])])),_:1})}}}))));var L;const F=T(j,[["__scopeId","data-v-c9074338"]]);export{F as default};
