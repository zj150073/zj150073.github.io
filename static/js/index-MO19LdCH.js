var t=Object.defineProperty,e=Object.defineProperties,i=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(e,i,o)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[i]=o,a=(t,e,i)=>new Promise(((o,s)=>{var r=t=>{try{a(i.next(t))}catch(e){s(e)}},n=t=>{try{a(i.throw(t))}catch(e){s(e)}},a=t=>t.done?o(t.value):Promise.resolve(t.value).then(r,n);a((i=i.apply(t,e)).next())}));import{u as p,P as u,_ as l,a as d,b as c}from"./@vue-flow-DUqaSUSV.js";import{_ as m}from"./icon.vue_vue_type_script_setup_true_lang-DySDbi7P.js";import{d as f}from"./dagre-ByuBQOTl.js";import{r as g,Y as y,U as j,d as h,c as v,s as b,B as w,D as P,n as k,o as x,a as _,aC as R,aD as C}from"./@vue-CFXrvzpc.js";import E from"./processNode-CD82f39N.js";import O from"./animationEdge-BDPX0nmy.js";import{_ as S}from"./index-B2iGRBN9.js";import"./@amap-Bx2D3lnM.js";import"./graphlib-DbWR6NsI.js";import"./lodash-Cqbeouo3.js";import"./@vueuse-tP1Y4vdd.js";import"./defu-iUM7Auia.js";import"./framesync-CUhBu5sQ.js";import"./style-value-types-UCYNu-x1.js";import"./popmotion-DRTv1-mp.js";import"./hey-listen-DkH12NBk.js";import"./vite-plugin-fake-server-CytHVkXj.js";import"./@faker-js-CRy60TLX.js";import"./version-rocket-chvOQqaV.js";import"./@pureadmin-f9nW_l6N.js";import"./vue-DWYrQbHy.js";import"./element-plus-DsFyl0Kk.js";import"./lodash-es-BgzC0s9P.js";import"./@element-plus-Bqpau_gV.js";import"./@popperjs-D3lHDW-0.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-BWHVJBZs.js";import"./async-validator-Cuo4gI4y.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-kghe82LF.js";import"./@iconify-icons-CxRB8ffa.js";import"./plus-pro-components-CYEVFP0q.js";import"./sortablejs-DhhifNSC.js";import"./axios-B1L2Kzed.js";import"./vue-i18n-DB-7wkrF.js";import"./@intlify-DfwD9yJy.js";import"./js-cookie-BXEMiIsG.js";import"./pinia-DzAV29mk.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-CGx-uoKe.js";import"./axs-request-CnYniYE7.js";import"./nprogress-L6f6pfEY.js";import"./echarts-D2b6xzX-.js";import"./zrender-CUz1GrA9.js";import"./tslib-ZseNXxlj.js";import"./vxe-table-CPtn8uUL.js";import"./xe-utils-CdBoVBzI.js";import"./dom-zindex-Ckn4mXSH.js";import"./responsive-storage-5vfjqqcs.js";import"./@iconify-BUzAfhQo.js";/* empty css                 */import"./vue-tippy-DPYCMIfw.js";function z(){const{findNode:t}=p(),a=g(new f.graphlib.Graph),l=g("LR");return{graph:a,layout:function(p,d,c){const m=new f.graphlib.Graph;a.value=m,m.setDefaultEdgeLabel((()=>({})));const g="LR"===c;m.setGraph({rankdir:c}),l.value=c;for(const e of p){const i=t(e.id);m.setNode(e.id,{width:i.dimensions.width||150,height:i.dimensions.height||50})}for(const t of d)m.setEdge(t.source,t.target);return f.layout(m),p.map((t=>{const a=m.node(t.id);return p=((t,e)=>{for(var i in e||(e={}))s.call(e,i)&&n(t,i,e[i]);if(o)for(var i of o(e))r.call(e,i)&&n(t,i,e[i]);return t})({},t),l={targetPosition:g?u.Left:u.Top,sourcePosition:g?u.Right:u.Bottom,position:{x:a.x,y:a.y}},e(p,i(l));var p,l}))},previousDirection:l}}function D(){return t=>{const e=function(t){const e=[];for(const i of t)for(const o of t)if(i.id!==o.id){const t=`e${i.id}-${o.id}`;e.push({id:t,source:i.id,target:o.id,type:"animation",animated:!0})}return e}(t);!function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}}(e);const i=new Set,o=[];for(const s of e)i.has(s.target)||0!==i.size&&!i.has(s.source)||(o.push(s),i.add(s.source),i.add(s.target));return o}}function L({graph:t,cancelOnError:e=!0}){const{updateNodeData:i,getConnectedEdges:o}=p(),s=y((()=>j(t))),r=g(!1),n=new Set,u=new Map,l=new Set;function d(t,p=!1){return a(this,null,(function*(){if(n.has(t.id))return;l.add(t.id);const c=o(t.id).filter((e=>e.target===t.id));if(yield Promise.all(c.map((t=>function(t){return a(this,null,(function*(){return new Promise((e=>{const i=setInterval((()=>{t()&&(clearInterval(i),e())}),100)}))}))}((()=>!t.data.isAnimating))))),l.clear(),!r.value)return;n.add(t.id),i(t.id,{isRunning:!0,isFinished:!1,hasError:!1,isCancelled:!1});const f=Math.floor(2e3*Math.random())+1e3;return new Promise((o=>{const r=setTimeout((()=>a(this,null,(function*(){const r=s.value.successors(t.id),n=Math.random()<.15;if(!p&&n&&(i(t.id,{isRunning:!1,hasError:!0}),j(e)))return yield m(t.id),u.delete(t.id),void o();i(t.id,{isRunning:!1,isFinished:!0}),u.delete(t.id),r.length>0&&(yield Promise.all(r.map((t=>d({id:t}))))),o()}))),p?0:f);u.set(t.id,r)}))}))}function c(t){f();for(const e of t)i(e.id,{isRunning:!1,isFinished:!1,hasError:!1,isSkipped:!1,isCancelled:!1})}function m(t){return a(this,null,(function*(){const e=s.value.successors(t);for(const t of e)i(t,{isRunning:!1,isSkipped:!0}),yield m(t)}))}function f(){r.value=!1,n.clear(),u.clear()}return{run:function(t){return a(this,null,(function*(){if(r.value)return;c(t),r.value=!0;const e=t.filter((t=>{var e;return 0===(null==(e=s.value.predecessors(t.id))?void 0:e.length)}));yield Promise.all(e.map((t=>d(t,!0)))),f()}))},stop:function(){return a(this,null,(function*(){r.value=!1;for(const t of l)clearTimeout(u.get(t)),u.delete(t),i(t,{isRunning:!1,isFinished:!1,hasError:!1,isSkipped:!1,isCancelled:!0}),yield m(t);for(const[t,e]of u)clearTimeout(e),u.delete(t),i(t,{isRunning:!1,isFinished:!1,hasError:!1,isSkipped:!1,isCancelled:!0}),yield m(t);n.clear(),l.clear()}))},reset:c,isRunning:r}}const I={x:0,y:0},M="process",N="animation",Y=[{id:"1",position:I,type:M},{id:"2",position:I,type:M},{id:"2a",position:I,type:M},{id:"2b",position:I,type:M},{id:"2c",position:I,type:M},{id:"2d",position:I,type:M},{id:"3",position:I,type:M},{id:"4",position:I,type:M},{id:"5",position:I,type:M},{id:"6",position:I,type:M},{id:"7",position:I,type:M}],F=[{id:"e1-2",source:"1",target:"2",type:N,animated:!0},{id:"e1-3",source:"1",target:"3",type:N,animated:!0},{id:"e2-2a",source:"2",target:"2a",type:N,animated:!0},{id:"e2-2b",source:"2",target:"2b",type:N,animated:!0},{id:"e2-2c",source:"2",target:"2c",type:N,animated:!0},{id:"e2c-2d",source:"2c",target:"2d",type:N,animated:!0},{id:"e3-7",source:"3",target:"4",type:N,animated:!0},{id:"e4-5",source:"4",target:"5",type:N,animated:!0},{id:"e5-6",source:"5",target:"6",type:N,animated:!0},{id:"e5-7",source:"5",target:"7",type:N,animated:!0}],T={class:"layout-flow"},B={class:"layout-panel"},G=(t=>(R("data-v-6094ddc5"),t=t(),C(),t))((()=>_("span",{class:"spinner"},null,-1))),X=S(h({__name:"index",setup(t){const e=g(Y),i=g(F),o=g(!0),s=D(),{graph:r,layout:n,previousDirection:u}=z(),{run:f,stop:y,reset:j,isRunning:h}=L({graph:r,cancelOnError:o}),{fitView:R}=p();function C(){return a(this,null,(function*(){yield y(),j(e.value),i.value=s(e.value),k((()=>{S(u.value)}))}))}function S(t){return a(this,null,(function*(){yield y(),j(e.value),e.value=n(e.value,i.value,t),k((()=>{R(),f(e.value)}))}))}return(t,o)=>(x(),v("div",T,[b(P(c),{nodes:e.value,edges:i.value,onNodesInitialized:o[4]||(o[4]=t=>S("LR"))},{"node-process":w((t=>[b(E,{data:t.data,"source-position":t.sourcePosition,"target-position":t.targetPosition},null,8,["data","source-position","target-position"])])),"edge-animation":w((t=>[b(O,{id:t.id,source:t.source,target:t.target,"source-x":t.sourceX,"source-y":t.sourceY,targetX:t.targetX,targetY:t.targetY,"source-position":t.sourcePosition,"target-position":t.targetPosition},null,8,["id","source","target","source-x","source-y","targetX","targetY","source-position","target-position"])])),default:w((()=>[b(P(l)),b(P(d),{class:"process-panel",position:"top-left"},{default:w((()=>[_("div",B,[P(h)?(x(),v("button",{key:0,class:"stop-btn",title:"stop",onClick:o[0]||(o[0]=(...t)=>P(y)&&P(y)(...t))},[b(m,{name:"stop"}),G])):(x(),v("button",{key:1,title:"start",onClick:o[1]||(o[1]=t=>P(f)(e.value))},[b(m,{name:"play"})])),_("button",{title:"set horizontal layout",onClick:o[2]||(o[2]=t=>S("LR"))},[b(m,{name:"horizontal"})]),_("button",{title:"set vertical layout",onClick:o[3]||(o[3]=t=>S("TB"))},[b(m,{name:"vertical"})]),_("button",{title:"shuffle graph",onClick:C},[b(m,{name:"shuffle"})])])])),_:1})])),_:1},8,["nodes","edges"])]))}}),[["__scopeId","data-v-6094ddc5"]]);export{X as default};
