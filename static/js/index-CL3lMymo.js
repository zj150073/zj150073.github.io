var h=Object.defineProperty;var c=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;var o=(s,e,t)=>e in s?h(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,r=(s,e)=>{for(var t in e||(e={}))p.call(e,t)&&o(s,t,e[t]);if(c)for(var t of c(e))l.call(e,t)&&o(s,t,e[t]);return s};var n=(s,e,t)=>o(s,typeof e!="symbol"?e+"":e,t);import{d as m,h as u,Y as d,c as g,o as f,u as w}from"./index-BuUfABzW.js";class T{constructor(e){n(this,"opts");n(this,"ws",null);n(this,"reconnectAttempts",0);n(this,"eventListeners",{open:[],message:[],close:[],error:[]});n(this,"shouldReconnect",!0);n(this,"pingTimeoutId");n(this,"reconnectTimerId");n(this,"defaultOptions",{pingTimeout:6e4,reconnectTimer:3e3,pingMsg:1,repeatLimit:null});this.opts=r(r({},this.defaultOptions),e),this.createWebSocket()}createWebSocket(){this.ws=new WebSocket(this.opts.url),this.setupEventHandlers()}setupEventHandlers(){this.ws&&(this.ws.onopen=e=>{this.onOpen(e),this.startHeartbeat()},this.ws.onmessage=e=>{this.onMessage(e),this.resetHeartbeat()},this.ws.onclose=e=>{this.onClose(e),this.stopHeartbeat(),this.scheduleReconnect()},this.ws.onerror=e=>{this.onError(e),this.ws.close()})}emit(e,...t){this.eventListeners[e].forEach(i=>i(...t))}scheduleReconnect(){this.reconnectAttempts>=this.opts.repeatLimit&&this.opts.repeatLimit||this.shouldReconnect&&(this.reconnectTimerId=window.setTimeout(()=>{this.reconnectAttempts++,this.createWebSocket()},this.opts.reconnectTimer))}onOpen(e){this.reconnectAttempts=0,this.emit("open",e)}onMessage(e){e.data!=="pong"&&this.emit("message",e)}onClose(e){this.emit("close",e)}onError(e){this.emit("error",e)}startHeartbeat(){this.pingTimeoutId=window.setInterval(()=>{var e;((e=this.ws)==null?void 0:e.readyState)===WebSocket.OPEN&&(this.opts.pingMsg++,this.ws.send(this.opts.pingMsg))},this.opts.pingTimeout)}resetHeartbeat(){this.pingTimeoutId&&(clearInterval(this.pingTimeoutId),this.startHeartbeat())}stopHeartbeat(){clearInterval(this.pingTimeoutId),this.pingTimeoutId=null}reconnect(){this.reconnectAttempts=0,clearTimeout(this.reconnectTimerId),this.createWebSocket()}send(e){if(this.ws)try{const t=typeof e=="string"?e:JSON.stringify(e);this.ws.send(t)}catch(t){}}close(){this.shouldReconnect=!1,this.ws.close()}on(e,t){this.eventListeners[e]&&this.eventListeners[e].push(t)}}const b=["innerHTML"],L=m({__name:"index",setup(s){let e=u(null),t=new T({url:`${location.protocol==="https:"?"wss":"ws"}://${location.hostname==="localhost"?"124.222.6.60":location.hostname}:8800`,repeatLimit:5,reconnectTimer:3e3,pingTimeout:1e3});return t.on("message",i=>{try{e.value=i.data}catch(a){}}),d(()=>{t.close()}),(i,a)=>(f(),g("div",{innerHTML:w(e)},null,8,b))}});export{L as default};
