const e=["width","height"],t=["width","height"],a=["width","height"],n=[Vue.createElementVNode("div",{class:"loading-gif_"},[Vue.createElementVNode("span"),Vue.createElementVNode("span"),Vue.createElementVNode("span"),Vue.createElementVNode("span"),Vue.createElementVNode("span")],-1)],i={class:"auth-control_"},o={class:"range-text"},s=[Vue.createElementVNode("div",null,null,-1),Vue.createElementVNode("div",null,null,-1),Vue.createElementVNode("div",null,null,-1)],l=Vue.defineComponent({__name:"App",props:{type:{type:String,default:"modal"},canvasWidth:{type:Number,default:310},canvasHeight:{type:Number,default:160},show:{type:Boolean,default:!1},puzzleScale:{type:Number,default:1},sliderSize:{type:Number,default:50},range:{type:Number,default:10},zIndex:{type:Number,default:999},imgs:{type:Array,default:null},successText:{type:String,default:"验证通过！"},failText:{type:String,default:"验证失败，请重试"},sliderText:{type:String,default:"拖动滑块完成拼图"},className:{type:String,default:""}},emits:["success","fail","close","reset"],setup(l,{expose:u,emit:r}){const c=l;Vue.onMounted((()=>{document.addEventListener("mousemove",S,!1),document.addEventListener("mouseup",T,!1),document.addEventListener("touchmove",S,{passive:!1}),document.addEventListener("touchend",T,!1),m.isInside="inside"===c.type,c.show&&(!m.isInside&&document.body.classList.add("vue-puzzle-overflow"),M())})),Vue.onUnmounted((()=>{m.timer1&&clearTimeout(m.timer1),document.removeEventListener("mousemove",S,!1),document.removeEventListener("mouseup",T,!1),document.removeEventListener("touchmove",S,!1),document.removeEventListener("touchend",T,!1)}));const d=Vue.ref(),h=Vue.ref(),p=Vue.ref(),v=Vue.ref(),m=Vue.reactive({isInside:!1,mouseDown:!1,startWidth:50,startX:0,newX:0,pinX:0,pinY:0,loading:!1,isCanSlide:!1,error:!1,infoBoxShow:!1,infoText:"",infoBoxFail:!1,timer1:void 0,closeDown:!1,isSuccess:!1,imgIndex:-1,isSubmting:!1});Vue.watch((()=>c.show),(e=>{e?(!m.isInside&&document.body.classList.add("vue-puzzle-overflow"),M()):(m.isSubmting=!1,m.isSuccess=!1,m.infoBoxShow=!1,document.body.classList.remove("vue-puzzle-overflow"))})),Vue.watch((()=>c.type),(e=>{"inside"===e?(m.isInside=!0,document.body.classList.remove("vue-puzzle-overflow")):m.isInside=!1}));const f=Vue.computed((()=>{const e=m.startWidth+m.newX-m.startX;return e<V.value?V.value:e>c.canvasWidth?c.canvasWidth:e})),g=Vue.computed((()=>Math.round(52.5*Math.max(Math.min(c.puzzleScale,2),.2)+6))),V=Vue.computed((()=>Math.max(Math.min(Math.round(c.sliderSize),Math.round(.5*c.canvasWidth)),10))),w=Vue.computed((()=>999!==c.zIndex?`z-index:${c.zIndex}`:"")),X=()=>{m.isInside||(m.closeDown=!0)},x=()=>{m.closeDown&&(!m.mouseDown&&!m.isSubmting&&(m.timer1&&clearTimeout(m.timer1),r("close"))),m.closeDown=!1},y=e=>{var t;m.isCanSlide&&(m.mouseDown=!0,m.startWidth=(null==(t=d.value)?void 0:t.clientWidth)||0,m.newX=void 0!==e.clientX?e.clientX:e.changedTouches[0].clientX,m.startX=void 0!==e.clientX?e.clientX:e.changedTouches[0].clientX)},S=e=>{m.mouseDown&&(e.preventDefault(),m.newX=void 0!==e.clientX?e.clientX:e.changedTouches[0].clientX)},T=()=>{m.mouseDown&&(m.mouseDown=!1,B())},Y=(e=!1)=>{var t;if(m.loading&&!e)return;m.loading=!0,m.isCanSlide=!1;const a=h.value,n=p.value,i=v.value,o=null==a?void 0:a.getContext("2d",{willReadFrequently:!0}),s=null==n?void 0:n.getContext("2d"),l=null==i?void 0:i.getContext("2d");if(!o||!s||!l)return;const u=navigator.userAgent.indexOf("Firefox")>=0&&navigator.userAgent.indexOf("Windows")>=0,r=document.createElement("img");if(o.fillStyle="rgba(255,255,255,1)",l.fillStyle="rgba(255,255,255,1)",o.clearRect(0,0,c.canvasWidth,c.canvasHeight),s.clearRect(0,0,c.canvasWidth,c.canvasHeight),m.pinX=C(g.value+20,c.canvasWidth-g.value-10),m.pinY=C(20,c.canvasHeight-g.value-10),r.crossOrigin="anonymous",r.onload=()=>{const[e,t,a,n]=b(r),i=Math.random(),d=Math.random(),h=Math.random(),p=i<.33?-1:i<.66?0:1,v=d<.33?-1:d<.66?0:1,f=h<.33?-1:h<.66?0:1;let V=Math.random()<.6?1:0;p===v&&v===f&&f===V&&0===V&&(V=1),o.save(),z(o,p,v,f,V),o.closePath(),u?(o.clip(),o.save(),o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowColor="#000",o.shadowBlur=3,o.fill(),o.restore()):(o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowColor="#000",o.shadowBlur=3,o.fill(),o.clip()),o.drawImage(r,e,t,a,n),l.fillRect(0,0,c.canvasWidth,c.canvasHeight),l.drawImage(r,e,t,a,n),o.globalCompositeOperation="source-atop",z(o,p,v,f,V),o.arc(m.pinX+Math.ceil(g.value/2),m.pinY+Math.ceil(g.value/2),1.2*g.value,0,2*Math.PI,!0),o.closePath(),o.shadowColor="rgba(255, 255, 255, .8)",o.shadowOffsetX=-1,o.shadowOffsetY=-1,o.shadowBlur=Math.min(Math.ceil(8*c.puzzleScale),12),o.fillStyle="#ffffaa",o.fill();const w=o.getImageData(m.pinX-3,m.pinY-20,m.pinX+g.value+5,m.pinY+g.value+5);s.putImageData(w,0,m.pinY-20),o.restore(),o.clearRect(0,0,c.canvasWidth,c.canvasHeight),o.save(),z(o,p,v,f,V),o.globalAlpha=.8,o.fillStyle="#ffffff",o.fill(),o.restore(),o.save(),o.globalCompositeOperation="source-atop",z(o,p,v,f,V),o.arc(m.pinX+Math.ceil(g.value/2),m.pinY+Math.ceil(g.value/2),1.2*g.value,0,2*Math.PI,!0),o.shadowColor="#000",o.shadowOffsetX=2,o.shadowOffsetY=2,o.shadowBlur=16,o.fill(),o.restore(),o.save(),o.globalCompositeOperation="destination-over",o.drawImage(r,e,t,a,n),o.restore(),m.loading=!1,m.isCanSlide=!0},r.onerror=()=>{Y(!0)},!e&&null!=(t=c.imgs)&&t.length){let e=C(0,c.imgs.length-1);e===m.imgIndex&&(e===c.imgs.length-1?e=0:e++),m.imgIndex=e,r.src=c.imgs[e]}else r.src=E()},C=(e,t)=>Math.ceil(Math.random()*(t-e)+e),b=e=>{const t=e.width/e.height;let a=0,n=0,i=0,o=0;return t>c.canvasWidth/c.canvasHeight?(o=c.canvasHeight,i=t*o,n=0,a=(c.canvasWidth-i)/2):(i=c.canvasWidth,o=i/t,a=0,n=(c.canvasHeight-o)/2),[a,n,i,o]},z=(e,t,a,n,i)=>{const o=Math.ceil(15*c.puzzleScale);e.beginPath(),e.moveTo(m.pinX,m.pinY),e.lineTo(m.pinX+o,m.pinY),e.arcTo(m.pinX+o,m.pinY+t*o/2,m.pinX+o+o/2,m.pinY+t*o/2,o/2),e.arcTo(m.pinX+o+o,m.pinY+t*o/2,m.pinX+o+o,m.pinY,o/2),e.lineTo(m.pinX+o+o+o,m.pinY),e.lineTo(m.pinX+o+o+o,m.pinY+o),e.arcTo(m.pinX+o+o+o+a*o/2,m.pinY+o,m.pinX+o+o+o+a*o/2,m.pinY+o+o/2,o/2),e.arcTo(m.pinX+o+o+o+a*o/2,m.pinY+o+o,m.pinX+o+o+o,m.pinY+o+o,o/2),e.lineTo(m.pinX+o+o+o,m.pinY+o+o+o),e.lineTo(m.pinX+o+o,m.pinY+o+o+o),e.arcTo(m.pinX+o+o,m.pinY+o+o+o+n*o/2,m.pinX+o+o/2,m.pinY+o+o+o+n*o/2,o/2),e.arcTo(m.pinX+o,m.pinY+o+o+o+n*o/2,m.pinX+o,m.pinY+o+o+o,o/2),e.lineTo(m.pinX,m.pinY+o+o+o),e.lineTo(m.pinX,m.pinY+o+o),e.arcTo(m.pinX+i*o/2,m.pinY+o+o,m.pinX+i*o/2,m.pinY+o+o/2,o/2),e.arcTo(m.pinX+i*o/2,m.pinY+o,m.pinX,m.pinY+o,o/2),e.lineTo(m.pinX,m.pinY)},E=()=>{const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)return"";e.width=c.canvasWidth,e.height=c.canvasHeight,t.fillStyle=`rgb(${C(100,255)},${C(100,255)},${C(100,255)})`,t.fillRect(0,0,c.canvasWidth,c.canvasHeight);for(let a=0;a<12;a++)if(t.fillStyle=`rgb(${C(100,255)},${C(100,255)},${C(100,255)})`,t.strokeStyle=`rgb(${C(100,255)},${C(100,255)},${C(100,255)})`,C(0,2)>1)t.save(),t.rotate(C(-90,90)*Math.PI/180),t.fillRect(C(-20,e.width-20),C(-20,e.height-20),C(10,e.width/2+10),C(10,e.height/2+10)),t.restore();else{t.beginPath();const a=C(-Math.PI,Math.PI);t.arc(C(0,e.width),C(0,e.height),C(10,e.height/2+10),a,a+1.5*Math.PI),t.closePath(),t.fill()}return e.toDataURL("image/png")},B=()=>{m.isSubmting=!0;const e=f.value-V.value-(g.value-V.value)*((f.value-V.value)/(c.canvasWidth-V.value)),t=m.pinX-3-e;Math.abs(t)<c.range?(m.infoText=c.successText,m.infoBoxFail=!1,m.infoBoxShow=!0,m.isCanSlide=!1,m.isSuccess=!0,m.timer1&&clearTimeout(m.timer1),m.timer1=setTimeout((()=>{m.isSubmting=!1,r("success",t,{deviation:t,offsetX:e,pinX:m.pinX-3})}),800)):(m.infoText=c.failText,m.infoBoxFail=!0,m.infoBoxShow=!0,m.isCanSlide=!1,r("fail",t,{deviation:t,offsetX:e,pinX:m.pinX-3}),m.timer1&&clearTimeout(m.timer1),m.timer1=setTimeout((()=>{m.isSubmting=!1,M()}),800))},M=e=>{m.isSubmting||(m.infoBoxFail=!1,m.infoBoxShow=!1,m.isCanSlide=!1,m.isSuccess=!1,m.startWidth=V.value,m.startX=0,m.newX=0,Y(),e&&r("reset"))};return u({reset:M}),(u,r)=>(Vue.openBlock(),Vue.createBlock(Vue.Teleport,{to:"body",disabled:m.isInside},[Vue.createElementVNode("div",{class:Vue.normalizeClass(["vue-puzzle-vcode",{inside_:m.isInside,show_:l.show},l.className]),style:Vue.normalizeStyle(Vue.unref(w)),onMousedown:X,onMouseup:x,onTouchstartPassive:X,onTouchend:x},[Vue.createElementVNode("div",{class:"vue-auth-box_",onMousedown:r[3]||(r[3]=Vue.withModifiers((()=>{}),["stop"])),onTouchstart:r[4]||(r[4]=Vue.withModifiers((()=>{}),["stop"]))},[Vue.createElementVNode("div",{class:"auth-body_",style:Vue.normalizeStyle(`width:${l.canvasWidth}px;height: ${l.canvasHeight}px`)},[Vue.createElementVNode("canvas",{ref_key:"canvas1",ref:h,class:"auth-canvas1_",width:l.canvasWidth,height:l.canvasHeight},null,8,e),Vue.createElementVNode("canvas",{ref_key:"canvas3",ref:v,class:Vue.normalizeClass(["auth-canvas3_",{show:m.isSuccess}]),width:l.canvasWidth,height:l.canvasHeight},null,10,t),Vue.createElementVNode("canvas",{ref_key:"canvas2",ref:p,class:"auth-canvas2_",width:Vue.unref(g),height:l.canvasHeight,style:Vue.normalizeStyle(`width:${Vue.unref(g)}px;height:${l.canvasHeight}px;transform:translateX(${Vue.unref(f)-Vue.unref(V)-(Vue.unref(g)-Vue.unref(V))*((Vue.unref(f)-Vue.unref(V))/(l.canvasWidth-Vue.unref(V)))}px)`)},null,12,a),Vue.createElementVNode("div",{class:Vue.normalizeClass(["loading-box_",{hide_:!m.loading}])},n,2),Vue.createElementVNode("div",{class:Vue.normalizeClass(["info-box_",{show:m.infoBoxShow},{fail:m.infoBoxFail}])},Vue.toDisplayString(m.infoText),3),Vue.createElementVNode("div",{class:Vue.normalizeClass(["flash_",{show:m.isSuccess}]),style:Vue.normalizeStyle(`transform: translateX(${m.isSuccess?`${l.canvasWidth+.578*l.canvasHeight}px`:`-${.578*l.canvasHeight}px`}) skew(-30deg, 0);`)},null,6),Vue.createElementVNode("img",{class:"reset_",onClick:r[0]||(r[0]=e=>M(!0)),src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAELklEQVRYR+2YW2wUZRTH//9vtlCoF9IoIklT3PqgPGi326hoetuaGEhIr9SgCYkkgt2WGOQVCca+GavWdr0GjD4YhG3RB3hply1LQA1tEQIxEXapGI2pEkys9LIzx2ylYWfY6e5sF0oi+7hzzvl+3/9855xvhrjNf7zN+XAHcL4Z+n8o6JWTeYt++W25S596AIZy6TB+n3yo+Nchlk8vmIIVowdXU9c3Q1gDSilBlQwjgBAYFGDvdF58/4milqvZwDpOcXWsb5Uh8hmBqkwXFMhlCN8aX5LXNbRy/T+Z+iXsHAFWRXs3QGQPyLucLDJrK5DgUXdTsxPfjAEro8E3Ce50EtxsKxPTwCPH3U2jTmJkBJgWTnAMxDeGMEoa0xQ+LJQnCD4HYFkCyAC3RdwN3U7gMkpxRTTYrMD91sCJIgCxV5R6O1Jcfy7VwonqLoj9/CqB2kF341qncGkBvRe+ureAWpRgoalCBecMFzcdK24YymZRJz5zprgq1tsJwXYL3CVZGvdGHmwZc7JQtra2gE+f712ep2QUYP714DJhaJrXLqXZQszlZwtYdSHoB9ljVk/ePVrSZFL0ZkAlxzQBVseCT8WhZhRThtFB8plk9Zi/qCi8cv0fNxvKFrDy4oF11NXXIFy2EII4iBcG3Y03VLZT8OqRd5aFPduvOEpxRayvXolxAKB2g6NgEhobBlc1HHYKY7WvHf5wtVAPgegIlbbZ9seUZ7AyFnwewi9pGoUyDmhrB931kfnC1ZwOeKlLP8GZJi6QLSFP2yep4toXSbT3ZQAfX3O6omt8Nhd9r/aHQAUMOQywYBZo5uZD2ThQ2rbPCjlnH6yI9rUryE5DU75ctJaake46Be4DuDjF8dFBNA94/AdtiySVxIlpMlTS8td801o70vMigM9huTda2lhcKHVHPO2HZv/P6LIwX7hk/+qzPSvUJGMkrg8AQYTkroRdXMlE+HH/twsG6BsOdJHYZlaO/lBZ6weOiiSXqs3Gqj0TeAxx+T75DIpgwjC0onD51pQD4JaluPrkR/cpFT9DcoVp84LOgTL/DjtBbglgou+puHwB8lEznPxJw1XSX77VtgizBvQNBw4RMqB7xt4Lc3c8lQKJaQHoO4R8ydz0/7MWoCXk8c85MrMC9J3qaafw/WtQlwXST+F3BnAeYB4obgJ1BJIuG+YtiKAjVOZ/Pd1ZdwzoG+4uBtSPpjaRbhXLcwF3hzytb2TilgVgT5BkYybBrTYC+Rvg5nRpdTRJrIs8+VPXPQXj2i4ItxC4O2NQQUQnN4U9rRcz9nH64p4ceM2lziX5Y4s3KHCdUHwE77ecMkMEp6BwhIa2Z6DslZRvfulgHafYLuCas58WLp2aLCFUga70qxOFU6dPFL2W1feYeaU43Y5z/TxnCuYabMEuC043ckdBp4pZ7f8FE5psOI1g6fwAAAAASUVORK5CYII="})],4),Vue.createElementVNode("div",i,[Vue.createElementVNode("div",{class:"range-box",style:Vue.normalizeStyle(`height:${Vue.unref(V)}px;width:${l.canvasWidth}px`)},[Vue.createElementVNode("div",o,Vue.toDisplayString(l.sliderText),1),Vue.createElementVNode("div",{class:"range-slider",ref_key:"rangeSlider",ref:d,style:Vue.normalizeStyle(`width:${Vue.unref(f)}px`)},[Vue.createElementVNode("div",{class:Vue.normalizeClass(["range-btn",{isDown:m.mouseDown}]),style:Vue.normalizeStyle(`width:${Vue.unref(V)}px`),onMousedown:r[1]||(r[1]=e=>y(e)),onTouchstart:r[2]||(r[2]=e=>y(e))},s,38)],4)],4)])],32)],38)],8,["disabled"]))}}),u={class:"font-medium"},r={class:"bg-[rgba(15,23,42,0.2)] p-6 w-[360px]"},c=Vue.defineComponent({__name:"verify",setup(e){const t=Vue.ref(!0);function a(){}function n(){}return(e,i)=>{const o=Vue.resolveComponent("el-link"),s=Vue.resolveComponent("el-card");return Vue.openBlock(),Vue.createBlock(s,{shadow:"never"},{header:Vue.withCtx((()=>[Vue.createElementVNode("div",u,[Vue.createVNode(o,{href:"https://github.com/javaLuo/vue-puzzle-vcode/tree/vue3",target:"_blank",style:{margin:"0 5px 4px 0","font-size":"16px"}},{default:Vue.withCtx((()=>[Vue.createTextVNode(" 拼图人机验证、右滑拼图验证 ")])),_:1})]),Vue.createVNode(o,{class:"mt-2",href:"https://github.com/pure-admin/vue-pure-admin/blob/main/src/views/able/verify.vue",target:"_blank"},{default:Vue.withCtx((()=>[Vue.createTextVNode(" 代码位置 src/views/able/verify.vue ")])),_:1})])),default:Vue.withCtx((()=>[Vue.createElementVNode("div",r,[Vue.createVNode(Vue.unref(l),{show:t.value,type:"inside",onFail:n,onSuccess:a},null,8,["show"])])])),_:1})}}});export{c as default};
