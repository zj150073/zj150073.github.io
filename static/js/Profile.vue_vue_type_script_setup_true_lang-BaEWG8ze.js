var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(l,a,o)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o;import{f as n}from"./mock-DoK9H7vT.js";import{E as i,m as u}from"./index-CQT2hjpo.js";import{R as c}from"./index-O5I_Amnm.js";import{n as m,A as d}from"./@pureadmin-f9nW_l6N.js";import{ar as p}from"./@iconify-icons-CxRB8ffa.js";import{d as f,r as v,S as b,a1 as y,o as h,c as g,s as w,B as _,D as V,E as j,a as x,j as k}from"./@vue-CFXrvzpc.js";const O=x("h3",{class:"my-8"},"个人信息",-1),P=x("span",{class:"ml-2"},"更新头像",-1),R={class:"dialog-footer"},C=f((U=((e,l)=>{for(var a in l||(l={}))t.call(l,a)&&s(e,a,l[a]);if(o)for(var a of o(l))r.call(l,a)&&s(e,a,l[a]);return e})({},{name:"Profile"}),l(U,a({__name:"Profile",setup(e){const l=v(""),a=v(),o=v(),t=v(),r=v(!1),s=v(),f=b({avatar:"",nickname:"",email:"",phone:"",description:""}),C=b({nickname:[{required:!0,message:"昵称必填",trigger:"blur"}]});function U(e,l){let a=[],o=[];[{value:"@qq.com"},{value:"@126.com"},{value:"@163.com"}].map((l=>o.push({value:e.split("@")[0]+l.value}))),a=e?o.filter((l=>0===l.value.toLowerCase().indexOf(e.toLowerCase()))):o,l(a)}const F=e=>{const a=new FileReader;a.onload=e=>{l.value=e.target.result,r.value=!0},a.readAsDataURL(e.raw)},I=()=>{o.value.hidePopover(),t.value.clearFiles(),r.value=!1},S=({blob:e})=>a.value=e,q=()=>{const e=d({files:new File([a.value],"avatar")});n(e).then((({success:e,data:l})=>{e?(u("更新头像成功",{type:"success"}),I()):u("更新头像失败")})).catch((e=>{u(`提交异常 ${e}`,{type:"error"})}))},D=e=>{return l=this,a=null,o=function*(){yield e.validate(((e,l)=>{e&&u("更新信息成功",{type:"success"})}))},new Promise(((e,t)=>{var r=e=>{try{n(o.next(e))}catch(l){t(l)}},s=e=>{try{n(o.throw(e))}catch(l){t(l)}},n=l=>l.done?e(l.value):Promise.resolve(l.value).then(r,s);n((o=o.apply(l,a)).next())}));var l,a,o};return i().then((e=>{Object.assign(f,e.data)})),(e,a)=>{const n=y("el-avatar"),i=y("IconifyIconOffline"),u=y("el-button"),d=y("el-upload"),v=y("el-form-item"),b=y("el-input"),E=y("el-autocomplete"),L=y("el-form"),z=y("el-dialog");return h(),g("div",{class:k(["min-w-[180px]",V(m)()?"max-w-[100%]":"max-w-[70%]"])},[O,w(L,{ref_key:"userInfoFormRef",ref:s,"label-position":"top",rules:C,model:f},{default:_((()=>[w(v,{label:"头像"},{default:_((()=>[w(n,{size:80,src:f.avatar},null,8,["src"]),w(d,{ref_key:"uploadRef",ref:t,accept:"image/*",action:"#",limit:1,"auto-upload":!1,"show-file-list":!1,"on-change":F},{default:_((()=>[w(u,{plain:"",class:"ml-4"},{default:_((()=>[w(i,{icon:V(p)},null,8,["icon"]),P])),_:1})])),_:1},512)])),_:1}),w(v,{label:"昵称",prop:"nickname"},{default:_((()=>[w(b,{modelValue:f.nickname,"onUpdate:modelValue":a[0]||(a[0]=e=>f.nickname=e),placeholder:"请输入昵称"},null,8,["modelValue"])])),_:1}),w(v,{label:"邮箱",prop:"email"},{default:_((()=>[w(E,{modelValue:f.email,"onUpdate:modelValue":a[1]||(a[1]=e=>f.email=e),"fetch-suggestions":U,"trigger-on-focus":!1,placeholder:"请输入邮箱",clearable:"",class:"w-full"},null,8,["modelValue"])])),_:1}),w(v,{label:"联系电话"},{default:_((()=>[w(b,{modelValue:f.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>f.phone=e),placeholder:"请输入联系电话",clearable:""},null,8,["modelValue"])])),_:1}),w(v,{label:"简介"},{default:_((()=>[w(b,{modelValue:f.description,"onUpdate:modelValue":a[3]||(a[3]=e=>f.description=e),placeholder:"请输入简介",type:"textarea",autosize:{minRows:6,maxRows:8},maxlength:"56","show-word-limit":""},null,8,["modelValue"])])),_:1}),w(u,{type:"primary",onClick:a[4]||(a[4]=e=>D(s.value))},{default:_((()=>[j(" 更新信息 ")])),_:1})])),_:1},8,["rules","model"]),w(z,{modelValue:r.value,"onUpdate:modelValue":a[5]||(a[5]=e=>r.value=e),width:"40%",title:"编辑头像","destroy-on-close":"",closeOnClickModal:!1,"before-close":I,fullscreen:V(m)()},{footer:_((()=>[x("div",R,[w(u,{bg:"",text:"",onClick:I},{default:_((()=>[j("取消")])),_:1}),w(u,{bg:"",text:"",type:"primary",onClick:q},{default:_((()=>[j(" 确定 ")])),_:1})])])),default:_((()=>[w(V(c),{ref_key:"cropRef",ref:o,imgSrc:l.value,onCropper:S},null,8,["imgSrc"])])),_:1},8,["modelValue","fullscreen"])],2)}}}))));var U;export{C as _};
